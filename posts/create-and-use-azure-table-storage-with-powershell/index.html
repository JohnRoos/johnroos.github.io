<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="/css/syntax.css">
    <link rel="stylesheet" type="text/css" href="/css/style.css">
    
    
    <title>RoosTech | Create and use Azure Table storage with PowerShell</title>
    <meta name="description" content="Azure Table storage is a quick and easy way to store data in the cloud. If you have an Azure subscription you can play around with you are up and running within minutes. Here is a short example on how to get started.
Create table To create an Azure Table we need to first have a resource group. Lets create one that is called &ldquo;MyAwesomeResourceGroup&rdquo; and place it in &ldquo;West Europe&rdquo;."/>
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-35019756-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

</head><body>
        <div class="container">

<nav class="navbar navbar-expand-lg navbar-dark ">
    <a class="navbar-brand" href="/">
        <div class="logo">RoosTech.se</div>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
  
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
   


        
        
            
              <li class="nav-item ">
                <a class="nav-link" href="/"> Home</a>
              </li>
            
        
            
              <li class="nav-item ">
                <a class="nav-link" href="/gists/"> Gists</a>
              </li>
            
        
            
              <li class="nav-item ">
                <a class="nav-link" href="/parameter-validation/"> Parameter validation</a>
              </li>
            
        

      </ul>

      <ul class="navbar-nav mr-right">

        
        
            
                <li class="nav-item navbar-right ">
                <a class="nav-link" href="/about/"> About me</a>
                </li>
            
        

        
      </ul>
    </div>
  </nav>

<div class="row">
                <div class="col-sm-9 blog-main section" id="blogposts">
<div class="blog-post">
  
    
    
    <time class="postdate" datetime="2020-03-11">Mar 11, 2020</time>

  <h1>Create and use Azure Table storage with PowerShell</h1>
  <p>Azure Table storage is a quick and easy way to store data in the cloud. If you have an Azure subscription you can play around with you are up and running within minutes. Here is a short example on how to get started.</p>
<h2 id="create-table">Create table</h2>
<p>To create an Azure Table we need to first have a resource group. Lets create one that is called &ldquo;MyAwesomeResourceGroup&rdquo; and place it in &ldquo;West Europe&rdquo;. When the resource group is created we need to create a storage account. In this example I have set it to use locally redundant storage since its cheap and for lab purposes.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nb">New-AzResourceGroup</span> <span class="n">-Name</span> <span class="s1">&#39;MyAwesomeResourceGroup&#39;</span> <span class="p">`</span> 
                    <span class="n">-Location</span> <span class="s1">&#39;West Europe&#39;</span>
 
<span class="nb">New-AzStorageAccount</span> <span class="n">-ResourceGroupName</span> <span class="s1">&#39;MyAwesomeResourceGroup&#39;</span> <span class="p">`</span>
                     <span class="n">-Name</span> <span class="s1">&#39;fancystorageaccount&#39;</span> <span class="p">`</span>
                     <span class="n">-SkuName</span> <span class="s1">&#39;Standard_LRS&#39;</span> <span class="p">`</span>
                     <span class="n">-Kind</span> <span class="s1">&#39;StorageV2&#39;</span> <span class="p">`</span>
                     <span class="n">-AccessTier</span> <span class="s1">&#39;Hot&#39;</span> 
                     <span class="n">-Location</span> <span class="s1">&#39;West Europe&#39;</span>
</code></pre></div><p>To continue, we also need a storage account key, so lets use the first one when we create the storage context. The storage context is needed when we create the table.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$StorageAccountKeys</span> <span class="p">=</span> <span class="nb">Get-AzStorageAccountKey</span> <span class="n">-ResourceGroupName</span> <span class="s1">&#39;MyAwesomeResourceGroup&#39;</span> <span class="p">`</span>
                                              <span class="n">-Name</span> <span class="s1">&#39;fancystorageaccount&#39;</span>
 
<span class="nv">$StorageContext</span> <span class="p">=</span> <span class="nb">New-AzStorageContext</span> <span class="n">-StorageAccountName</span> <span class="s1">&#39;fancystorageaccount&#39;</span> <span class="p">`</span>
                                       <span class="n">-StorageAccountKey</span> <span class="nv">$StorageAccountKeys</span><span class="p">[</span><span class="n">0</span><span class="p">].</span><span class="n">Value</span>
</code></pre></div><p>Now we are ready to create the Azure Table using the storage context. Lets name it &ldquo;KickassTable&rdquo;, because that&rsquo;s the name it deserves.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$StorageTable</span> <span class="p">=</span> <span class="nb">New-AzStorageTable</span> <span class="n">-Name</span> <span class="s1">&#39;KickassTable&#39;</span> <span class="n">-Context</span> <span class="nv">$StorageContext</span>
</code></pre></div><p>That&rsquo;s it. Now we have a new Azure Table storage.</p>
<h2 id="query-table">Query table</h2>
<p>So how do we use it then? Its actually fairly simple. Especially if you are using the AzTable module. Install the AzTable module, then create the Azure table object. This object is needed later when we query for data.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nb">Install-Module</span> <span class="n">-Name</span> <span class="n">AzTable</span>
 
<span class="nv">$AzureTable</span> <span class="p">=</span> <span class="nb">Get-AzTableTable</span> <span class="n">-TableName</span> <span class="s1">&#39;KickassTable&#39;</span> <span class="p">`</span>
                               <span class="n">-ResourceGroup</span> <span class="s1">&#39;MyAwesomeResourceGroup&#39;</span> <span class="p">`</span>
                               <span class="n">-StorageAccountName</span> <span class="s1">&#39;fancystorageaccount&#39;</span>
</code></pre></div><p>Now we are ready to add some rows into the table. We need to set a partition key and a row key before adding the actual data, which is represented as properties.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nb">Add-AzTableRow</span> <span class="n">-Table</span> <span class="nv">$AzureTable</span> <span class="p">`</span>
               <span class="n">-PartitionKey</span> <span class="s1">&#39;Test&#39;</span> <span class="p">`</span>
               <span class="n">-RowKey</span> <span class="s1">&#39;Lab01&#39;</span> <span class="p">`</span>
               <span class="n">-Property</span> <span class="p">@{</span><span class="s1">&#39;SomeKey&#39;</span><span class="p">=</span><span class="s1">&#39;some value&#39;</span><span class="p">}</span>
</code></pre></div><p>To query the table we use the command Get-AzTableRow.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># If you don&#39;t provide any filters all rows will be returned.</span>
<span class="nb">Get-AzTableRow</span> <span class="n">-Table</span> <span class="nv">$AzureTable</span>
 
<span class="c"># Perhaps you want only the rows matching a certain partition key and row key.</span>
<span class="nb">Get-AzTableRow</span> <span class="n">-Table</span> <span class="nv">$AzureTable</span> <span class="n">-PartitionKey</span> <span class="s1">&#39;Test&#39;</span> <span class="n">-RowKey</span> <span class="s1">&#39;Lab01&#39;</span>
 
<span class="c"># You can even query the properties you provided earlier (which are stored as key-value pairs).</span>
<span class="nb">Get-AzTableRow</span> <span class="n">-Table</span> <span class="nv">$AzureTable</span> <span class="n">-ColumnName</span> <span class="n">SomeKey</span> <span class="n">-Value</span> <span class="s1">&#39;some value&#39;</span> <span class="n">-Operator</span> <span class="n">Equal</span>
</code></pre></div><p>Now that we feel that we have worked enough with our data, its time to remove it. A row can be removed with filters in the same way as when you get a row, but its also possible to use an entire row as parameter value.</p>
<p>First, lets get the row. Then remove the row by using it as a parameter value.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$rows</span> <span class="p">=</span> <span class="nb">Get-AzTableRow</span> <span class="n">-Table</span> <span class="nv">$AzureTable</span> <span class="n">-ColumnName</span> <span class="n">SomeKey</span> <span class="n">-Value</span> <span class="s1">&#39;some value&#39;</span> <span class="n">-Operator</span> <span class="n">Equal</span>
 
<span class="nb">Remove-AzTableRow</span> <span class="n">-entity</span> <span class="nv">$rows</span> <span class="n">-Table</span> <span class="nv">$AzureTable</span>
</code></pre></div><p>Thats it. This is a very quick introduction to how to create a table and manage the data in it.</p>

  <div class="blog-post-meta-bottom">
    
        Posted by: John<br />
    
    
        Tags: 
                PowerShell
            
                Azure Tables
            
    
  </div>

  
    <div class="related-posts">
      
      
      <h3>Related posts</h3>
      <ul>
        
        <li><a href="/posts/use-edit-command-to-discover-the-code-behind-built-in-cmdlets/">Use Edit-Command to discover the code behind built-in cmdlets</a></li>
        
        <li><a href="/posts/invoke-restmethod-with-anti-forgery-tokens-in-header-and-cookie/">Invoke-RestMethod with anti-forgery tokens in header and cookie</a></li>
        
        <li><a href="/posts/introducing-the-inimanager-module/">Introducing the IniManager module</a></li>
        
        <li><a href="/posts/use-powershell-jobs-to-ping-many-from-many-with-log/">Use PowerShell jobs to ping many from many with log</a></li>
        
        <li><a href="/posts/powershell-logo-made-with-css3/">PowerShell logo made with CSS3</a></li>
        
      </ul>
    </div>
    
  
</div>


  <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "blog-roostech-se" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>




                </div>
                <div class="col-sm-3 col-sm-offset0 blog-sidebar section" id="sidebar"><div id="sidebar">
    
    <div class="author">
        <img width="120" height="120" alt="John Roos" src="/img/face.jpg"><br>
        <a title="About John Roos" href="http://blog.roostech.se/about">John Roos</a>
    </div>
    
    <div id="recentPosts">
            <div class="recentposts">
                <div class="recentposts-header">RECENT POSTS</div>
            
                <div class="recent">
                    <h1><a class="title" href="/posts/pester-5-discovery-and-testcases/">Pester 5: Discovery and TestCases</a></h1>
                    Pester 5 was released a couple of days ago which brings a lot of new features and changes to how we write tests. One of the major changes in Pester 5 is the Discovery phase. In this post I will attempt to explain how Discover...
                </div>
            
                <div class="recent">
                    <h1><a class="title" href="/posts/create-and-use-azure-table-storage-with-powershell/">Create and use Azure Table storage with PowerShell</a></h1>
                    Azure Table storage is a quick and easy way to store data in the cloud. If you have an Azure subscription you can play around with you are up and running within minutes. Here is a short example on how to get started.
Create t...
                </div>
            
                <div class="recent">
                    <h1><a class="title" href="/posts/use-edit-command-to-discover-the-code-behind-built-in-cmdlets/">Use Edit-Command to discover the code behind built-in cmdlets</a></h1>
                    Did you know that there are a lot of built-in cmdlets which are written entirely in PowerShell? Did you also know that you can view the source of those cmdlets? Well, you can. Get-Command shows all the details we need. When y...
                </div>
            
                <div class="recent">
                    <h1><a class="title" href="/posts/invoke-restmethod-with-anti-forgery-tokens-in-header-and-cookie/">Invoke-RestMethod with anti-forgery tokens in header and cookie</a></h1>
                    To help prevent cross-site scripting attacks some websites uses anti-forgery tokens. If you would like to talk to a REST API which uses this security measure you might run into problems if you are trying to use the PowerShell...
                </div>
            
                <div class="recent">
                    <h1><a class="title" href="/posts/introducing-the-inimanager-module/">Introducing the IniManager module</a></h1>
                    Some time ago I wanted to find a DSC resource which would help me in configuring ini files. I did not really find any resource which was dynamic enough for my needs so I ended up writing my own. Since I want my DSC resources ...
                </div>
            
            </div>
    </div>

</div></div>
            </div>
            <footer class="footer"><div class="feet">
<p class="footer text-center">Copyright (c) 2020 John Roos</p>
</div>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
</footer>
        </div>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
</body>
</html>