<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="/css/syntax.css">
    <link rel="stylesheet" type="text/css" href="/css/style.css">
    
    
    <title>RoosTech | Dynamic parameters in PowerShell executes before you know it</title>
    <meta name="description" content="When creating script cmdlets in PowerShell you can use dynamic parameters to create some advanced parameters. A few months back I was playing around a bit with dynamic parameters to see how it works and I noticed that the logic for the dynamic parameters is executed as soon as the verb is written in the console within PowerShell ISE.
Let&rsquo;s create a cmdlet to prove this theory. The cmdlet below will simply open a text file in the PowerShell ISE from the folder C:\temp."/>
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-35019756-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

</head><body>
        <div class="container">

<nav class="navbar navbar-expand-lg navbar-dark ">
    <a class="navbar-brand" href="/">
        <div class="logo">RoosTech.se</div>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
  
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
   


        
        
            
              <li class="nav-item ">
                <a class="nav-link" href="/"> Home</a>
              </li>
            
        
            
              <li class="nav-item ">
                <a class="nav-link" href="/gists/"> Gists</a>
              </li>
            
        
            
              <li class="nav-item ">
                <a class="nav-link" href="/parameter-validation/"> Parameter validation</a>
              </li>
            
        

      </ul>

      <ul class="navbar-nav mr-right">

        
        
            
                <li class="nav-item navbar-right ">
                <a class="nav-link" href="/about/"> About me</a>
                </li>
            
        

        
      </ul>
    </div>
  </nav>

<div class="row">
                <div class="col-sm-9 blog-main section" id="blogposts">
  <div class="blog-post">
    
    
    
    <time class="postdate" datetime="2015-07-21">Jul 21, 2015</time>

    <h1>Dynamic parameters in PowerShell executes before you know it</h1>
    
    
    
    <p>When creating script cmdlets in PowerShell you can use dynamic parameters to create some advanced parameters. A few months back I was playing around a bit with dynamic parameters to see how it works and I noticed that the logic for the dynamic parameters is executed as soon as the verb is written in the console within PowerShell ISE.</p>
<p><img src="/images/dynamicparams.jpg#center" alt="Dynamic parameters in PowerShell"></p>
<p>Let&rsquo;s create a cmdlet to prove this theory. The cmdlet below will simply open a text file in the PowerShell ISE from the folder C:\temp. The advanced parameter will show the available text files in the folder when using the console in PowerShell ISE.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="k">Function</span> <span class="nb">Open-TextFile</span> <span class="p">{</span>
    <span class="p">[</span><span class="k">CmdletBinding</span><span class="p">()]</span>
    <span class="k">Param</span><span class="p">()</span>
    <span class="k">DynamicParam</span> <span class="p">{</span>
        <span class="nv">$attributes</span> <span class="p">=</span> <span class="nb">new-object</span> <span class="n">System</span><span class="p">.</span><span class="n">Management</span><span class="p">.</span><span class="n">Automation</span><span class="p">.</span><span class="n">ParameterAttribute</span>
        <span class="nv">$attributes</span><span class="p">.</span><span class="k">ParameterSetName</span> <span class="p">=</span> <span class="s2">&#34;__AllParameterSets&#34;</span>
        <span class="nv">$attributes</span><span class="p">.</span><span class="k">Mandatory</span> <span class="p">=</span> <span class="nv">$true</span>
         
        <span class="nv">$attributeCollection</span> <span class="p">=</span> <span class="nb">new-object</span> <span class="n">-Type</span> <span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">ObjectModel</span><span class="p">.</span><span class="n">Collection</span><span class="no">[System.Attribute]</span>
        <span class="nv">$attributeCollection</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="nv">$attributes</span><span class="p">)</span>
         
        <span class="nv">$folder</span> <span class="p">=</span> <span class="s1">&#39;C:\temp&#39;</span>
        <span class="nv">$_Values</span> <span class="p">=</span> <span class="p">(</span><span class="nb">Get-ChildItem</span> <span class="n">-Path</span> <span class="nv">$folder</span> <span class="n">-Name</span> <span class="p">*.</span><span class="n">txt</span><span class="p">).</span><span class="n">PSChildName</span>
                 
        <span class="nv">$ValidateSet</span> <span class="p">=</span> <span class="nb">new-object</span> <span class="n">System</span><span class="p">.</span><span class="n">Management</span><span class="p">.</span><span class="n">Automation</span><span class="p">.</span><span class="n">ValidateSetAttribute</span><span class="p">(</span><span class="nv">$_Values</span><span class="p">)</span>
                 
        <span class="nv">$attributeCollection</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="nv">$ValidateSet</span><span class="p">)</span>
         
         
        <span class="nv">$dynParam1</span> <span class="p">=</span> <span class="nb">new-object</span> <span class="n">-Type</span> <span class="n">System</span><span class="p">.</span><span class="n">Management</span><span class="p">.</span><span class="n">Automation</span><span class="p">.</span><span class="n">RuntimeDefinedParameter</span><span class="p">(</span><span class="s2">&#34;File&#34;</span><span class="p">,</span> <span class="no">[string]</span><span class="p">,</span> <span class="nv">$attributeCollection</span><span class="p">)</span>
         
        <span class="nv">$paramDictionary</span> <span class="p">=</span> <span class="nb">new-object</span> <span class="n">-Type</span> <span class="n">System</span><span class="p">.</span><span class="n">Management</span><span class="p">.</span><span class="n">Automation</span><span class="p">.</span><span class="n">RuntimeDefinedParameterDictionary</span>
        <span class="nv">$paramDictionary</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&#34;File&#34;</span><span class="p">,</span> <span class="nv">$dynParam1</span><span class="p">)</span>
        <span class="k">return</span> <span class="nv">$paramDictionary</span>
    <span class="p">}</span>
 
    <span class="k">Process</span> 
    <span class="p">{</span>
        <span class="nv">$file</span> <span class="p">=</span> <span class="nv">$PSBoundParameters</span><span class="p">.</span><span class="n">file</span>
        <span class="nb">ise </span><span class="s2">&#34;$folder\$file&#34;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>What if we add an extra line in there to add a new file in that folder when the dynamic parameter logic is executed, like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="k">Function</span> <span class="nb">Open-TextFile</span> <span class="p">{</span>
    <span class="p">[</span><span class="k">CmdletBinding</span><span class="p">()]</span>
    <span class="k">Param</span><span class="p">()</span>
    <span class="k">DynamicParam</span> <span class="p">{</span>
        <span class="nv">$attributes</span> <span class="p">=</span> <span class="nb">new-object</span> <span class="n">System</span><span class="p">.</span><span class="n">Management</span><span class="p">.</span><span class="n">Automation</span><span class="p">.</span><span class="n">ParameterAttribute</span>
        <span class="nv">$attributes</span><span class="p">.</span><span class="k">ParameterSetName</span> <span class="p">=</span> <span class="s2">&#34;__AllParameterSets&#34;</span>
        <span class="nv">$attributes</span><span class="p">.</span><span class="k">Mandatory</span> <span class="p">=</span> <span class="nv">$true</span>
         
        <span class="nv">$attributeCollection</span> <span class="p">=</span> <span class="nb">new-object</span> <span class="n">-Type</span> <span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">ObjectModel</span><span class="p">.</span><span class="n">Collection</span><span class="no">[System.Attribute]</span>
        <span class="nv">$attributeCollection</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="nv">$attributes</span><span class="p">)</span>
         
        <span class="nv">$folder</span> <span class="p">=</span> <span class="s1">&#39;C:\temp&#39;</span>
        <span class="c"># write a timestamp to a file. This will be executed as soon as you write &#34;Open-&#34; in the console without having to complete the full cmdlet name.</span>
        <span class="nb">Get-Date</span> <span class="p">|</span> <span class="nb">Out-File</span> <span class="n">-FilePath</span> <span class="s2">&#34;$folder\test.txt&#34;</span> <span class="n">-Append</span>
        <span class="nv">$_Values</span> <span class="p">=</span> <span class="p">(</span><span class="nb">Get-ChildItem</span> <span class="n">-Path</span> <span class="nv">$folder</span> <span class="n">-Name</span> <span class="p">*.</span><span class="n">txt</span><span class="p">).</span><span class="n">PSChildName</span>
                 
        <span class="nv">$ValidateSet</span> <span class="p">=</span> <span class="nb">new-object</span> <span class="n">System</span><span class="p">.</span><span class="n">Management</span><span class="p">.</span><span class="n">Automation</span><span class="p">.</span><span class="n">ValidateSetAttribute</span><span class="p">(</span><span class="nv">$_Values</span><span class="p">)</span>
                 
        <span class="nv">$attributeCollection</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="nv">$ValidateSet</span><span class="p">)</span>
         
         
        <span class="nv">$dynParam1</span> <span class="p">=</span> <span class="nb">new-object</span> <span class="n">-Type</span> <span class="n">System</span><span class="p">.</span><span class="n">Management</span><span class="p">.</span><span class="n">Automation</span><span class="p">.</span><span class="n">RuntimeDefinedParameter</span><span class="p">(</span><span class="s2">&#34;File&#34;</span><span class="p">,</span> <span class="no">[string]</span><span class="p">,</span> <span class="nv">$attributeCollection</span><span class="p">)</span>
         
        <span class="nv">$paramDictionary</span> <span class="p">=</span> <span class="nb">new-object</span> <span class="n">-Type</span> <span class="n">System</span><span class="p">.</span><span class="n">Management</span><span class="p">.</span><span class="n">Automation</span><span class="p">.</span><span class="n">RuntimeDefinedParameterDictionary</span>
        <span class="nv">$paramDictionary</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&#34;File&#34;</span><span class="p">,</span> <span class="nv">$dynParam1</span><span class="p">)</span>
        <span class="k">return</span> <span class="nv">$paramDictionary</span>
    <span class="p">}</span>
 
    <span class="k">Process</span> 
    <span class="p">{</span>
        <span class="nv">$file</span> <span class="p">=</span> <span class="nv">$PSBoundParameters</span><span class="p">.</span><span class="n">file</span>
        <span class="nb">ise </span><span class="s2">&#34;$folder\$file&#34;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>Now load this cmdlet into memory and then write only &ldquo;open-&rdquo; in the console. Now check the folder c:\temp\ and you will find that a file has been created containing the timestamp for when the code was executed.</p>
<p>This means that the logic for dynamic parameters are executed at the same time as when the PowerShell ISE is trying to find which cmdlets are matching the verb you have written. I would have thought that the dynamic parameter logic would be executed when I have written the entire name of the cmdlet, but that is not the case.</p>

    
    <div class="blog-post-meta-bottom">
      
          Posted by: John<br />
      
      
          Tags: 
                  PowerShell
              
                  Parameters
              
      
    </div>

    
      <div class="related-posts">
        
        
        <h3>Related posts</h3>
        <ul>
          
          <li><a href="/posts/how-to-use-splatting-in-powershell/">How to use splatting in PowerShell</a></li>
          
          <li><a href="/posts/making-powershell-expressions-easier/">Making PowerShell expressions easier</a></li>
          
          <li><a href="/posts/simple-select-from-database-with-powershell/">Simple select from database with PowerShell</a></li>
          
          <li><a href="/posts/get-imdbmovie-using-invoke-webrequest/">Get-IMDBmovie using Invoke-WebRequest</a></li>
          
          <li><a href="/posts/classes-in-powershell-5.0/">Classes in Powershell 5.0</a></li>
          
        </ul>
      </div>
      
    
  </div>

  
    <div class="disqus-section">
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "blog-roostech-se" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  

                </div>
                <div class="col-sm-3 col-sm-offset0 blog-sidebar section" id="sidebar"><div id="sidebar">
   
    <div class="author">
        <img width="120" height="120" alt="John Roos" src="/img/face.jpg"><br>
        <a title="About John Roos" href="http://blog.roostech.se/about">John Roos</a>
    </div>
   
    <div id="recentPosts">
            <div class="recentposts">
                <div class="recentposts-header">RECENT POSTS</div>
            
                <div class="recent">
                    <h1><a class="title" href="/posts/deploy-azure-function-app-without-downtime/">Deploy Azure Function App without downtime</a></h1>
                    Deploying a function app without downtime should be standard practice for anyone working with Azure Functions, but it does not come out of the box. It requires an understanding of how function apps gets configured, how deploy...
                </div>
            
                <div class="recent">
                    <h1><a class="title" href="/posts/moving-from-blogger-to-github-pages-with-hugo/">Moving from Blogger to GitHub Pages using Hugo</a></h1>
                    For a while now I have felt that it takes too long time for me to write blog posts. I spend a long time figuring out how to make the post look right, when I should be spending time on the content. In the end this puts me off ...
                </div>
            
                <div class="recent">
                    <h1><a class="title" href="/posts/pester-5-discovery-and-testcases/">Pester 5: Discovery and TestCases</a></h1>
                    Pester 5 was released a couple of days ago which brings a lot of new features and changes to how we write tests. One of the major changes in Pester 5 is the Discovery phase. In this post I will attempt to explain how Discover...
                </div>
            
                <div class="recent">
                    <h1><a class="title" href="/posts/create-and-use-azure-table-storage-with-powershell/">Create and use Azure Table storage with PowerShell</a></h1>
                    Azure Table storage is a quick and easy way to store data in the cloud. If you have an Azure subscription you can play around with you are up and running within minutes. Here is a short example on how to get started.
Create t...
                </div>
            
                <div class="recent">
                    <h1><a class="title" href="/posts/use-edit-command-to-discover-the-code-behind-built-in-cmdlets/">Use Edit-Command to discover the code behind built-in cmdlets</a></h1>
                    Did you know that there are a lot of built-in cmdlets which are written entirely in PowerShell? Did you also know that you can view the source of those cmdlets? Well, you can. Get-Command shows all the details we need. When y...
                </div>
            
            </div>
    </div>

</div></div>
            </div>
            <footer class="footer"><div class="feet">
<p class="footer text-center">Copyright (c) 2020 John Roos</p>
</div>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
</footer>
        </div>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
</body>
</html>