<!DOCTYPE html>
<html lang="en">




    



<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.86, maximum-scale=5.0, minimum-scale=0.86">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/css/syntax.css">
    <link rel="stylesheet" type="text/css" href="/css/style.css">

    <meta name='twitter:card'        content='summary' />
    <meta name='twitter:site'        content='@johnmroos'/>
    <meta name='twitter:creator'     content='@johnmroos'/>
    <meta name='twitter:title'       content='Get-IMDBmovie using Invoke-WebRequest' />
    <meta name='twitter:description' content='Some time ago I was playing around a bit with Invoke-WebRequest and wanted to know a bit more about what I could do with that cmdlet. I ended up creating a cmdlet to get movie information from IMDB.com. I thought I would share how that script since the same principles can be applied in many situations.
PS C:\&gt; Get-ImdbMovie -Title &#39;Star Trek&#39; Title : Star Trek Into Darkness Directors : J.' />
    
    <meta name='twitter:domain'      content='https://blog.roostech.se/'/>
    

    <title>Get-IMDBmovie using Invoke-WebRequest</title>
    <meta name="description" content="Some time ago I was playing around a bit with Invoke-WebRequest and wanted to know a bit more about what I could do with that cmdlet. I ended up creating a cmdlet to get movie information from IMDB.com. I thought I would share how that script since the same principles can be applied in many situations.
PS C:\&gt; Get-ImdbMovie -Title &#39;Star Trek&#39; Title : Star Trek Into Darkness Directors : J."/>
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-35019756-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

</head><body>
        <div class="container">
<input class="explorer-toggle" type="checkbox" id="explorer-toggle">
<label class="explorer-toggle-label" for="explorer-toggle"><div class="explorer-toggle-label-clickablearea"></div></label>

<div class="explorer-toggle-label-selection"></div>

<div class="left-menu-button-bar"></div>

<diV class='left-menu'>
    
    <ul class="root">
        <li class="root"><div class="menu-item folder open"><a class="menu-item-site" href="https://blog.roostech.se/">blog.roostech.se (HUGOVSCODE)</a></div>
            <ul>  
                <li><span class="menu-item folder open">content</span>
                    <ul>
                        <li><span class="menu-item folder open">posts</span>
                            <ul>
                                
                                <li ><a href="/posts/deploy-azure-function-app-without-downtime/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Deploy Azure Function App without downtime.md</span></a></li>
                                
                                <li ><a href="/posts/moving-from-blogger-to-github-pages-with-hugo/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Moving from Blogger to GitHub Pages using Hugo.md</span></a></li>
                                
                                <li ><a href="/posts/pester-5-discovery-and-testcases/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Pester 5: Discovery and TestCases.md</span></a></li>
                                
                                <li ><a href="/posts/create-and-use-azure-table-storage-with-powershell/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Create and use Azure Table storage with PowerShell.md</span></a></li>
                                
                                <li ><a href="/posts/use-edit-command-to-discover-the-code-behind-built-in-cmdlets/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Use Edit-Command to discover the code behind built-in cmdlets.md</span></a></li>
                                
                                <li ><a href="/posts/invoke-restmethod-with-anti-forgery-tokens-in-header-and-cookie/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Invoke-RestMethod with anti-forgery tokens in header and cookie.md</span></a></li>
                                
                                <li ><a href="/posts/introducing-the-inimanager-module/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Introducing the IniManager module.md</span></a></li>
                                
                                <li ><a href="/posts/use-powershell-jobs-to-ping-many-from-many-with-log/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Use PowerShell jobs to ping many from many with log.md</span></a></li>
                                
                                <li ><a href="/posts/powershell-logo-made-with-css3/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">PowerShell logo made with CSS3.md</span></a></li>
                                
                                <li ><a href="/posts/what-is-this-here-string-people-are-talking-about/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">What is this here-string people are talking about?.md</span></a></li>
                                
                                <li ><a href="/posts/dynamic-parameters-in-powershell-executes-before-you-know-it/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Dynamic parameters in PowerShell executes before you know it.md</span></a></li>
                                
                                <li ><a href="/posts/making-powershell-expressions-easier/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Making PowerShell expressions easier.md</span></a></li>
                                
                                <li ><a href="/posts/simple-select-from-database-with-powershell/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Simple select from database with PowerShell.md</span></a></li>
                                
                                <li ><a href="/posts/how-to-use-splatting-in-powershell/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">How to use splatting in PowerShell.md</span></a></li>
                                
                                <li class="current"><a href="/posts/get-imdbmovie-using-invoke-webrequest/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Get-IMDBmovie using Invoke-WebRequest.md</span></a></li>
                                
                                <li ><a href="/posts/classes-in-powershell-5.0/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Classes in Powershell 5.0.md</span></a></li>
                                
                                <li ><a href="/posts/how-to-get-started-with-powershell/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">How to get started with Powershell.md</span></a></li>
                                
                                <li ><a href="/posts/powershell-script-find-hotfix-status/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Powershell script: Find hotfix status.md</span></a></li>
                                
                                <li ><a href="/posts/powershell-script-write-object-to-sql/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Powershell script: Write object to SQL.md</span></a></li>
                                
                                <li ><a href="/posts/get-type-alternative-for-null-values/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Get-Type alternative for $null values.md</span></a></li>
                                
                                <li ><a href="/posts/compress-files-to-zip-with-powershell/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Compress files to Zip with Powershell.md</span></a></li>
                                
                                <li ><a href="/posts/enable-real-time-jmx-monitoring-in-cognos/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Enable real time JMX monitoring in Cognos.md</span></a></li>
                                
                                <li ><a href="/posts/move-data-or-log-files-for-tempdb-in-sql-server/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Move data or log files for TempDB in SQL Server.md</span></a></li>
                                
                                <li ><a href="/posts/resources-for-remotefx-in-windows-server-2012/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Resources for RemoteFX in Windows Server 2012.md</span></a></li>
                                
                                <li ><a href="/posts/rdp-8.0-for-windows-7-sp1/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">RDP 8.0 for Windows 7 SP1.md</span></a></li>
                                
                                <li ><a href="/posts/improving-remotefx-performance-in-hyper-v/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Improving RemoteFX performance in Hyper-V.md</span></a></li>
                                
                                <li ><a href="/posts/configure-remotefx-in-hyper-v-running-windows-server-2012-with-low-end-gpu/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Configure RemoteFX in Hyper-V running Windows Server 2012 with low end GPU.md</span></a></li>
                                
                                <li ><a href="/posts/sqlps-and-its-limitations/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">SQLPS and its limitations.md</span></a></li>
                                
                                <li ><a href="/posts/script-deployment-of-ssis-packages-from-folder/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Script deployment of SSIS packages from folder.md</span></a></li>
                                
                                <li ><a href="/posts/dynamic-deploy-of-ssrs-reports-using-rs.exe/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Dynamic deploy of SSRS reports using rs.exe.md</span></a></li>
                                
                                <li ><a href="/posts/remove-headers-in-excel-exports-to-fix-column-alignment/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Remove headers in Excel exports to fix column alignment.md</span></a></li>
                                
                                <li ><a href="/posts/using-executionlog2-for-statistics-and-monitoring/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Using ExecutionLog2 for statistics and monitoring.md</span></a></li>
                                
                            </ul>
                        </li>
                        <li><span class="menu-item folder open">pages</span>
                            <ul>
                                
                                <li ><a href="/about/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">About me.md</span></a></li>
                                
                            </ul>
                        </li>
                    </ul>
                </li>
                <li><span class="menu-item folder">data</span></li>
                <li><span class="menu-item folder">layouts</span></li>
                <li><span class="menu-item folder">resources</span></li>
                <li><span class="menu-item folder">static</span></li>
                <li><span class="menu-item folder open">themes</span>
                    <ul>
                        <li><span class="menu-item folder open">hugovscode</span>
                            <ul>
                                <li><a href="https://github.com/JohnRoos/HugoVSCode/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">.git</span></a></li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li>config.toml</li>
            </ul>
        </li>
    </ul>
  

    
</diV><div class='main'>
     
     
     
    
     
    
     
    
     
    
     
    
    
        
        <div class="main-tabs">
            <div class="main-tabs-scroll">
                <div class="main-tabs-table">
                    <div class ="main-tabs-row">
                        <div class="main-tab">
                            <span class="rotate-letter md-icon">&#10144;</span> <a href="/">Home.md</a> 
                        </div>
                    
                        <div class="main-tab current">
                            <span class="rotate-letter md-icon">&#10144;</span> <i>Get-IMDBmovie using Invoke-Webrequest.md</i> 
                        </div>
                    
                    
                        <div class="main-tab">
                            <span class="rotate-letter md-icon">&#10144;</span> <a href="/posts/deploy-azure-function-app-without-downtime/">Deploy Azure Function App without downtime.md</a>
                        </div>
                    
                        <div class="main-tab">
                            <span class="rotate-letter md-icon">&#10144;</span> <a href="/posts/moving-from-blogger-to-github-pages-with-hugo/">Moving from Blogger to GitHub Pages using Hugo.md</a>
                        </div>
                    
                        <div class="main-tab">
                            <span class="rotate-letter md-icon">&#10144;</span> <a href="/posts/pester-5-discovery-and-testcases/">Pester 5: Discovery and TestCases.md</a>
                        </div>
                    
                        <div class="main-tab">
                            <span class="rotate-letter md-icon">&#10144;</span> <a href="/posts/create-and-use-azure-table-storage-with-powershell/">Create and use Azure Table storage with PowerShell.md</a>
                        </div>
                    
                        <div class="main-tab">
                            <span class="rotate-letter md-icon">&#10144;</span> <a href="/posts/use-edit-command-to-discover-the-code-behind-built-in-cmdlets/">Use Edit-Command to discover the code behind built-in cmdlets.md</a>
                        </div>
                    
                    </div>
                </div>
            </div>
        </div>
        <div class="main-path">
            <span><a class="path-link" href="https://blog.roostech.se/">blog.roostech.se</a></span><span class="folder">content</span><span class="folder">posts</span><span class="folder">Get-IMDBmovie using Invoke-WebRequest.md</span>
            
                    
                    
                    <span class="postdate-container">&nbsp;(<time class="postdate" datetime="2015-03-04">March 4, 2015</time>)</span>
                
        </div>
        <div class="main-content-toggle">

            
            <input class="source-preview-split" type="checkbox" id="source-preview-split-toggle">
            <label class="source-preview-split-label" for="source-preview-split-toggle"></label>

            <input class="source-toggle" type="checkbox" id="source-toggle">
            <label class="source-toggle-label" for="source-toggle"></label>

            <div class="main-content">
                ---<br />
                <span class="md-frontmatter">title</span>: <span class="md-frontmatter-string">Get-IMDBmovie using Invoke-WebRequest</span><br />
                <span class="md-frontmatter">date</span>: 2015-03-04 14:14:00 &#43;0200 &#43;0200<br />
                <span class="md-frontmatter">draft</span>: <span class="md-frontmatter">false</span><br />
                <span class="md-frontmatter">author</span>: <span class="md-frontmatter-string">John</span><br />
                ----
                <p>Some time ago I was playing around a bit with Invoke-WebRequest and wanted to know a bit more about what I could do with that cmdlet. I ended up creating a cmdlet to get movie information from IMDB.com. I thought I would share how that script since the same principles can be applied in many situations.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">PS C:\&gt; Get-ImdbMovie -Title &#39;Star Trek&#39;

 Title       : Star Trek Into Darkness
 Directors   : J.J. Abrams 
 Year        : 2013
 Rating      : 7.8 
 Description : After the crew of the Enterprise find an unstoppable force of terror from within their
               own organization, Captain Kirk leads a manhunt to a war-zone world to capture a one-man
               weapon of mass destruction.
 Writers     : Roberto Orci, Alex Kurtzman, 2 more credits 
 Stars       : Chris Pine, Zachary Quinto, Zoe Saldana 
 Link        : http://www.imdb.com/title/tt1408101/

PS C:\&gt;
</code></pre></div><p>This script will first send a web request to the search page on IMBD and then parse it for results. If any results are returned then the script will pick up the link to the first movie in the result. The movie link will be used in a second request to get all the details about the movie. The complete script can be found at the bottom of this post.</p>
<h2 id="advanced-function">Advanced function</h2>
<p>So lets get started. First we want to create an advanced function so that we can use it like a cmdlet. The parameter Title need to be required.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="k">function</span> <span class="nb">Get-ImdbMovie</span>
<span class="p">{</span>
    <span class="p">[</span><span class="k">CmdletBinding</span><span class="p">()]</span>
    <span class="k">Param</span>
    <span class="p">(</span>
        <span class="c"># Enter the title of the movie you want to get information about</span>
        <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$true</span><span class="p">,</span>
                   <span class="k">ValueFromPipelineByPropertyName</span><span class="p">=</span><span class="nv">$true</span><span class="p">,</span>
                   <span class="k">Position</span><span class="p">=</span><span class="n">0</span><span class="p">)]</span>
        <span class="p">[</span><span class="n">ValidateNotNullorEmpty</span><span class="p">()]</span>
        <span class="no">[string]</span><span class="nv">$Title</span>
    <span class="p">)</span>
    <span class="k">Process</span> <span class="p">{</span> 
        <span class="c">#this is where the rest of the code goes</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>Replace any spaces with %20 so that we can use it in an URL. Other special characters could be replaced as well, but in this case we only handle spaces</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$searchTitle</span> <span class="p">=</span> <span class="nv">$Title</span><span class="p">.</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;%20&#39;</span><span class="p">)</span>
</code></pre></div><h2 id="parse-search-results">Parse search results</h2>
<p>Now lets fetch the search page on IMDB.com with the title in the URL.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$imdbURL</span> <span class="p">=</span> <span class="s2">&#34;http://www.imdb.com/search/title?title=$searchTitle&amp;title_type=feature&#34;</span>
<span class="nv">$moviesearch</span> <span class="p">=</span> <span class="nb">Invoke-WebRequest</span> <span class="nv">$imdbURL</span>
</code></pre></div><p>The entire web page is now stored in the $moviesearch variable. In the HTML on the IMDB site there is a class called &ldquo;title&rdquo; which we want to get.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$titleclassarray</span> <span class="p">=</span> <span class="nv">$moviesearch</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> <span class="nb">where </span><span class="n">Class</span> <span class="o">-eq</span> <span class="s1">&#39;title&#39;</span> <span class="p">|</span> <span class="nb">select </span><span class="n">-First</span> <span class="n">1</span>
</code></pre></div><p>If the search did not match any movies, then the &ldquo;title&rdquo; class shouldnt exist and the $titleclassarray will be empty. Check if the array contains anything useful. If it does, then we can continue, otherwise just break the script. Lets double check just to be sure.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="k">try</span> <span class="p">{</span>
       <span class="nv">$titleclass</span> <span class="p">=</span> <span class="nv">$titleclassarray</span><span class="p">[</span><span class="n">0</span><span class="p">]</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">{</span>
      <span class="nb">Write-Warning</span> <span class="s2">&#34;No movie found matching that title.
</span><span class="s2">      break
</span><span class="s2">}
</span><span class="s2">         
</span><span class="s2">if (!($titleclass)){
</span><span class="s2">      Write-Warning &#34;</span><span class="n">No</span> <span class="n">movie</span> <span class="n">found</span> <span class="n">matching</span> <span class="n">that</span> <span class="n">title</span><span class="p">.</span>
      <span class="k">break</span>
<span class="p">}</span>
</code></pre></div><p>Now we want to get the link to the main page for the first movie in the search result. First we use some regular expression to parse the HTML to find all links. The regexp expression filters out all href tags and gets the URL in those tags. All the links found will be stored in the $linksfound variable.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$regex</span> <span class="p">=</span> <span class="s2">&#34;&lt;\s*a\s*[^&gt;]*?href\s*=\s*[</span><span class="se">`&#34;</span><span class="s2">&#39;]*([^</span><span class="se">`&#34;</span><span class="s2">&#39;&gt;]+)[^&gt;]*?&gt;&#34;</span>
<span class="nv">$linksFound</span> <span class="p">=</span> <span class="no">[Regex]</span><span class="p">::</span><span class="n">Matches</span><span class="p">(</span><span class="nv">$titleclass</span><span class="p">.</span><span class="n">innerHTML</span><span class="p">,</span> <span class="nv">$regex</span><span class="p">,</span> <span class="s2">&#34;IgnoreCase&#34;</span><span class="p">)</span>
</code></pre></div><p>Any link to a movie page will contain the string &ldquo;/title/&rdquo; in the URL, so lets parse through all the links to see if we can find any link with that string. The results will be saved in the variable $titlelink.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$titlelink</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">ArrayList</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$link</span> <span class="k">in</span> <span class="nv">$linksFound</span><span class="p">)</span>
<span class="p">{</span>
     <span class="nv">$trimmedlink</span> <span class="p">=</span> <span class="nv">$link</span><span class="p">.</span><span class="n">Groups</span><span class="p">[</span><span class="n">1</span><span class="p">].</span><span class="n">Value</span><span class="p">.</span><span class="n">Trim</span><span class="p">()</span>
     <span class="k">if</span> <span class="p">(</span><span class="nv">$trimmedlink</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="s1">&#39;/title/&#39;</span><span class="p">))</span> 
     <span class="p">{</span>
           <span class="no">[void]</span> <span class="nv">$titlelink</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="nv">$trimmedlink</span><span class="p">)</span>
     <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h2 id="parse-movie-page">Parse movie page</h2>
<p>Next we want to fetch the real movie page from IMDB. The first string in $titlelink will be added to <a href="http://www.imdb.com">www.imdb.com</a>. Lets fetch it in english, to make it easier. Change this to any language you want.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$movieURL</span> <span class="p">=</span> <span class="s2">&#34;http://www.imdb.com</span><span class="p">$(</span><span class="nv">$titlelink</span><span class="p">[</span><span class="n">0</span><span class="p">])</span><span class="s2">&#34;</span>
<span class="nv">$moviehtml</span> <span class="p">=</span> <span class="nb">Invoke-WebRequest</span> <span class="nv">$movieURL</span> <span class="n">-Headers</span> <span class="p">@{</span><span class="s2">&#34;Accept-Language&#34;</span><span class="p">=</span><span class="s2">&#34;en-US,en;&#34;</span><span class="p">}</span>
</code></pre></div><p>Now the html for the movie page is stored in $moviehtml variable. Again we need to parse through the html to get the information we want. Next, create the movie object. This is what will be returned to the pipeline in the end.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$movie</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">-TypeName</span> <span class="n">psobject</span>
</code></pre></div><p>Search through the HTML for a tag which uses the class called &lsquo;itemprop&rsquo;. If we use the innerText method we will get the text within that tab. This is where the title is. Add the title to the $movie object.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="p">`</span>
            <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="p">`</span>
            <span class="n">-Name</span> <span class="s2">&#34;Title&#34;</span> <span class="n">-Value</span> <span class="p">`</span>
            <span class="p">(</span><span class="nv">$moviehtml</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> <span class="nb">where </span><span class="n">Class</span> <span class="o">-eq</span> <span class="s1">&#39;itemprop&#39;</span> <span class="p">|</span> <span class="nb">select </span><span class="n">-First</span> <span class="n">1</span><span class="p">).</span><span class="n">innerText</span>
</code></pre></div><p>Continue to search through the html for the other information that we want.
Directors is a bit more tricky. Its in a tag using the class &ldquo;txt-block&rdquo; but that class is used in more places so we need to dig a bit deeper and try to find a H4 tag with the class &ldquo;inline&rdquo; which actually contains the text &ldquo;Director:&rdquo;. Then we need to remove some html tags around the text that we want to save.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="k">foreach</span> <span class="p">(</span><span class="nv">$line</span> <span class="k">in</span> <span class="p">(</span><span class="nv">$moviehtml</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> <span class="nb">where </span><span class="n">Class</span> <span class="o">-eq</span> <span class="s1">&#39;txt-block&#39;</span><span class="p">).</span><span class="n">InnerHTML</span> <span class="n">-split</span> <span class="s2">&#34;</span><span class="se">`n</span><span class="s2">&#34;</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">-like</span> <span class="s1">&#39;*Director:*&#39;</span><span class="p">){</span>
        <span class="nv">$line</span> <span class="p">=</span> <span class="nv">$line</span><span class="p">.</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39;&lt;/SPAN&gt;&lt;/A&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="p">`</span>
                   <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="p">`</span>
                   <span class="n">-Name</span> <span class="s2">&#34;Directors&#34;</span> <span class="p">`</span>
                   <span class="n">-Value</span> <span class="nv">$line</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">0</span><span class="p">,</span><span class="nv">$line</span><span class="p">.</span><span class="n">LastIndexOf</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)+</span><span class="n">1</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>We continue like this to parse out what we need for the rest of the information.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Year can be found in the tag using a class called &#34;nobr&#34; where we select the first result</span>
<span class="c"># and then remove some parantheses.</span>
<span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="p">`</span>
           <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="p">`</span>
           <span class="n">-Name</span> <span class="s2">&#34;Year&#34;</span> <span class="p">`</span>
           <span class="n">-Value</span> <span class="p">((</span><span class="nv">$moviehtml</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> 
                    <span class="nb">where </span><span class="n">Class</span> <span class="o">-eq</span> <span class="s1">&#39;nobr&#39;</span> <span class="p">|</span> 
                    <span class="nb">select </span><span class="n">-First</span> <span class="n">1</span><span class="p">).</span><span class="n">innerText</span><span class="p">).</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
 
<span class="c"># Rating can be found in the tag using the class &#34;titlePageSprite star-box-giga-star&#34;</span>
<span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="p">`</span>
           <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="p">`</span>
           <span class="n">-Name</span> <span class="s2">&#34;Rating&#34;</span>
           <span class="n">-Value</span> <span class="p">(</span><span class="nv">$moviehtml</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> 
                    <span class="nb">where </span><span class="n">Class</span> <span class="o">-eq</span> <span class="s1">&#39;titlePageSprite star-box-giga-star&#39;</span> <span class="p">|</span> 
                    <span class="nb">select </span><span class="n">-First</span> <span class="n">1</span><span class="p">).</span><span class="n">innerText</span>
 
<span class="c"># Description can be found in the tag using the class &#34;description&#34;</span>
<span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="p">`</span>
           <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="p">`</span>
           <span class="n">-Name</span> <span class="s2">&#34;Description&#34;</span> <span class="p">`</span>
           <span class="n">-Value</span> <span class="p">(</span><span class="nv">$moviehtml</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> 
                    <span class="nb">where </span><span class="n">itemprop</span> <span class="o">-eq</span> <span class="s1">&#39;description&#39;</span> <span class="p">|</span> 
                    <span class="nb">select </span><span class="n">-first</span> <span class="n">1</span><span class="p">).</span><span class="n">InnerText</span>
 
<span class="c"># Writers</span>
<span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="p">`</span>
           <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="p">`</span>
           <span class="n">-Name</span> <span class="s2">&#34;Writers&#34;</span> <span class="p">`</span>
           <span class="n">-Value</span> <span class="p">(</span><span class="nv">$moviehtml</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> 
                    <span class="nb">where </span><span class="n">itemprop</span> <span class="o">-eq</span> <span class="s1">&#39;creator&#39;</span> <span class="p">|</span> 
                    <span class="nb">select </span><span class="n">-first</span> <span class="n">1</span><span class="p">).</span><span class="n">InnerText</span><span class="p">.</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39;Writers:&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39; »&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
 
<span class="c"># Stars</span>
<span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="p">`</span>
           <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="p">`</span>
           <span class="n">-Name</span> <span class="s2">&#34;Stars&#34;</span> <span class="p">`</span>
           <span class="n">-Value</span> <span class="p">(</span><span class="nv">$moviehtml</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> 
                    <span class="nb">where </span><span class="n">itemprop</span> <span class="o">-eq</span> <span class="s1">&#39;actors&#39;</span><span class="p">).</span><span class="n">InnerText</span><span class="p">.</span><span class="n">Replace</span><span class="p">(</span>
                             <span class="s1">&#39;Stars:&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39; | See full cast and crew »&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</code></pre></div><p>The last thing we want to add to the object is the link to the page where the information comes from. After that the object can be returned to the pipeline.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="n">-Name</span> <span class="s2">&#34;Link&#34;</span> <span class="n">-Value</span> <span class="nv">$movieURL</span>
<span class="nv">$movie</span>
</code></pre></div><h2 id="complete-cmdlet-with-verbose-output">Complete cmdlet with verbose output</h2>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="cm">&lt;#
</span><span class="cm"></span><span class="sd">.Synopsis</span><span class="cm">
</span><span class="cm">   This scripts will get some basic information from IMDB about a movie by parcing the html code on the website.
</span><span class="cm"></span><span class="sd">.DESCRIPTION</span><span class="cm">
</span><span class="cm">   This scripts will get some basic information from IMDB about a movie by parcing the html code on the website.
</span><span class="cm"></span><span class="sd">.EXAMPLE</span><span class="cm">
</span><span class="cm">   Get-ImdbMovie -Title &#39;star trek&#39;
</span><span class="cm"></span><span class="sd">.EXAMPLE</span><span class="cm">
</span><span class="cm">   Get-ImdbMovie -Title &#39;star trek&#39; -verbose
</span><span class="cm"></span><span class="sd">.NOTES</span><span class="cm">
</span><span class="cm">   Created by John Roos
</span><span class="cm">   http://blog.roostech.se
</span><span class="cm">#&gt;</span>
<span class="k">function</span> <span class="nb">Get-ImdbMovie</span>
<span class="p">{</span>
    <span class="p">[</span><span class="k">CmdletBinding</span><span class="p">()]</span>
    <span class="k">Param</span>
    <span class="p">(</span>
        <span class="c"># Enter the title of the movie you want to get information about</span>
        <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$true</span><span class="p">,</span>
                   <span class="k">ValueFromPipelineByPropertyName</span><span class="p">=</span><span class="nv">$true</span><span class="p">,</span>
                   <span class="k">Position</span><span class="p">=</span><span class="n">0</span><span class="p">)]</span>
        <span class="p">[</span><span class="n">ValidateNotNullorEmpty</span><span class="p">()]</span>
        <span class="no">[string]</span><span class="nv">$Title</span>
    <span class="p">)</span>
 
    <span class="k">Process</span>
    <span class="p">{</span>
        <span class="nv">$searchTitle</span> <span class="p">=</span> <span class="nv">$Title</span><span class="p">.</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;%20&#39;</span><span class="p">)</span>
 
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Fetching search results&#34;</span>
        <span class="nv">$moviesearch</span> <span class="p">=</span> <span class="nb">Invoke-WebRequest</span> <span class="s2">&#34;http://www.imdb.com/search/title?title=$searchTitle&amp;title_type=feature&#34;</span>
         
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Moving html elements into variable&#34;</span>
        <span class="nv">$titleclassarray</span> <span class="p">=</span> <span class="nv">$moviesearch</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> <span class="nb">where </span><span class="n">Class</span> <span class="o">-eq</span> <span class="s1">&#39;title&#39;</span> <span class="p">|</span> <span class="nb">select </span><span class="n">-First</span> <span class="n">1</span>
         
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Checking if result contains movies&#34;</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nv">$titleclass</span> <span class="p">=</span> <span class="nv">$titleclassarray</span><span class="p">[</span><span class="n">0</span><span class="p">]</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nb">Write-Warning</span> <span class="s2">&#34;No movie found matching that title http://www.imdb.com/search/title?title=$searchTitle&amp;title_type=feature&#34;</span>
            <span class="k">break</span>
        <span class="p">}</span>
         
        <span class="k">if</span> <span class="p">(!(</span><span class="nv">$titleclass</span><span class="p">)){</span>
            <span class="nb">Write-Warning</span> <span class="s2">&#34;No movie found matching that title http://www.imdb.com/search/title?title=$searchTitle&amp;title_type=feature&#34;</span>
            <span class="k">break</span>
        <span class="p">}</span>
         
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Result contains movies.&#34;</span>
         
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Parcing HTML for movie link.&#34;</span>
        <span class="nv">$regex</span> <span class="p">=</span> <span class="s2">&#34;&lt;\s*a\s*[^&gt;]*?href\s*=\s*[</span><span class="se">`&#34;</span><span class="s2">&#39;]*([^</span><span class="se">`&#34;</span><span class="s2">&#39;&gt;]+)[^&gt;]*?&gt;&#34;</span>
        <span class="nv">$linksFound</span> <span class="p">=</span> <span class="no">[Regex]</span><span class="p">::</span><span class="n">Matches</span><span class="p">(</span><span class="nv">$titleclass</span><span class="p">.</span><span class="n">innerHTML</span><span class="p">,</span> <span class="nv">$regex</span><span class="p">,</span> <span class="s2">&#34;IgnoreCase&#34;</span><span class="p">)</span>
         
        <span class="nv">$titlelink</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">ArrayList</span>
        <span class="k">foreach</span><span class="p">(</span><span class="nv">$link</span> <span class="k">in</span> <span class="nv">$linksFound</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nv">$trimmedlink</span> <span class="p">=</span> <span class="nv">$link</span><span class="p">.</span><span class="n">Groups</span><span class="p">[</span><span class="n">1</span><span class="p">].</span><span class="n">Value</span><span class="p">.</span><span class="n">Trim</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$trimmedlink</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="s1">&#39;/title/&#39;</span><span class="p">))</span> <span class="p">{</span>
                <span class="no">[void]</span> <span class="nv">$titlelink</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="nv">$trimmedlink</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Movie link found.&#34;</span>
 
        <span class="nv">$movieURL</span> <span class="p">=</span> <span class="s2">&#34;http://www.imdb.com</span><span class="p">$(</span><span class="nv">$titlelink</span><span class="p">[</span><span class="n">0</span><span class="p">])</span><span class="s2">&#34;</span>
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Fetching movie page.&#34;</span>
        <span class="nv">$moviehtml</span> <span class="p">=</span> <span class="nb">Invoke-WebRequest</span> <span class="nv">$movieURL</span> <span class="n">-Headers</span> <span class="p">@{</span><span class="s2">&#34;Accept-Language&#34;</span><span class="p">=</span><span class="s2">&#34;en-US,en;&#34;</span><span class="p">}</span>
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Movie page fetched.&#34;</span>
 
        <span class="nv">$movie</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">-TypeName</span> <span class="n">psobject</span>
 
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Parcing for title.&#34;</span>
        <span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="n">-Name</span> <span class="s2">&#34;Title&#34;</span> <span class="n">-Value</span> <span class="p">(</span><span class="nv">$moviehtml</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> <span class="nb">where </span><span class="n">Class</span> <span class="o">-eq</span> <span class="s1">&#39;itemprop&#39;</span> <span class="p">|</span> <span class="nb">select </span><span class="n">-First</span> <span class="n">1</span><span class="p">).</span><span class="n">innerText</span>
 
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Parcing for directors.&#34;</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$line</span> <span class="k">in</span> <span class="p">(</span><span class="nv">$moviehtml</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> <span class="nb">where </span><span class="n">Class</span> <span class="o">-eq</span> <span class="s1">&#39;txt-block&#39;</span><span class="p">).</span><span class="n">InnerHTML</span> <span class="n">-split</span> <span class="s2">&#34;</span><span class="se">`n</span><span class="s2">&#34;</span><span class="p">){</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">-like</span> <span class="s1">&#39;*Director:*&#39;</span><span class="p">){</span>
                <span class="nv">$line</span> <span class="p">=</span> <span class="nv">$line</span><span class="p">.</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39;&lt;/SPAN&gt;&lt;/A&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="n">-Name</span> <span class="s2">&#34;Directors&#34;</span> <span class="n">-Value</span> <span class="nv">$line</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">0</span><span class="p">,</span><span class="nv">$line</span><span class="p">.</span><span class="n">LastIndexOf</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)+</span><span class="n">1</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
 
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Parcing for year.&#34;</span>
        <span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="n">-Name</span> <span class="s2">&#34;Year&#34;</span> <span class="n">-Value</span> <span class="p">((</span><span class="nv">$moviehtml</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> <span class="nb">where </span><span class="n">Class</span> <span class="o">-eq</span> <span class="s1">&#39;nobr&#39;</span> <span class="p">|</span> <span class="nb">select </span><span class="n">-First</span> <span class="n">1</span><span class="p">).</span><span class="n">innerText</span><span class="p">).</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
 
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Parcing for rating.&#34;</span>
        <span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="n">-Name</span> <span class="s2">&#34;Rating&#34;</span> <span class="n">-Value</span> <span class="p">(</span><span class="nv">$moviehtml</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> <span class="nb">where </span><span class="n">Class</span> <span class="o">-eq</span> <span class="s1">&#39;titlePageSprite star-box-giga-star&#39;</span> <span class="p">|</span> <span class="nb">select </span><span class="n">-First</span> <span class="n">1</span><span class="p">).</span><span class="n">innerText</span>
 
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Parcing for description.&#34;</span>
        <span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="n">-Name</span> <span class="s2">&#34;Description&#34;</span> <span class="n">-Value</span> <span class="p">(</span><span class="nv">$moviehtml</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> <span class="nb">where </span><span class="n">itemprop</span> <span class="o">-eq</span> <span class="s1">&#39;description&#39;</span> <span class="p">|</span> <span class="nb">select </span><span class="n">-first</span> <span class="n">1</span><span class="p">).</span><span class="n">InnerText</span>
 
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Parcing for writers.&#34;</span>
        <span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="n">-Name</span> <span class="s2">&#34;Writers&#34;</span> <span class="n">-Value</span> <span class="p">(</span><span class="nv">$moviehtml</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> <span class="nb">where </span><span class="n">itemprop</span> <span class="o">-eq</span> <span class="s1">&#39;creator&#39;</span> <span class="p">|</span> <span class="nb">select </span><span class="n">-first</span> <span class="n">1</span><span class="p">).</span><span class="n">InnerText</span><span class="p">.</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39;Writers:&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39; »&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
 
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Parcing for stars.&#34;</span>
        <span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="n">-Name</span> <span class="s2">&#34;Stars&#34;</span> <span class="n">-Value</span> <span class="p">(</span><span class="nv">$moviehtml</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> <span class="nb">where </span><span class="n">itemprop</span> <span class="o">-eq</span> <span class="s1">&#39;actors&#39;</span><span class="p">).</span><span class="n">InnerText</span><span class="p">.</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39;Stars:&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39; | See full cast and crew »&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
 
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Adding the link.&#34;</span>
        <span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="n">-Name</span> <span class="s2">&#34;Link&#34;</span> <span class="n">-Value</span> <span class="nv">$movieURL</span>
 
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Returning object.&#34;</span>
        <span class="nv">$movie</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
            </div>

            
            <div class="main-content-preview">
                <h1>Get-IMDBmovie using Invoke-WebRequest</h1>
                
                <p>Some time ago I was playing around a bit with Invoke-WebRequest and wanted to know a bit more about what I could do with that cmdlet. I ended up creating a cmdlet to get movie information from IMDB.com. I thought I would share how that script since the same principles can be applied in many situations.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">PS C:\&gt; Get-ImdbMovie -Title &#39;Star Trek&#39;

 Title       : Star Trek Into Darkness
 Directors   : J.J. Abrams 
 Year        : 2013
 Rating      : 7.8 
 Description : After the crew of the Enterprise find an unstoppable force of terror from within their
               own organization, Captain Kirk leads a manhunt to a war-zone world to capture a one-man
               weapon of mass destruction.
 Writers     : Roberto Orci, Alex Kurtzman, 2 more credits 
 Stars       : Chris Pine, Zachary Quinto, Zoe Saldana 
 Link        : http://www.imdb.com/title/tt1408101/

PS C:\&gt;
</code></pre></div><p>This script will first send a web request to the search page on IMBD and then parse it for results. If any results are returned then the script will pick up the link to the first movie in the result. The movie link will be used in a second request to get all the details about the movie. The complete script can be found at the bottom of this post.</p>
<h2 id="advanced-function">Advanced function</h2>
<p>So lets get started. First we want to create an advanced function so that we can use it like a cmdlet. The parameter Title need to be required.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="k">function</span> <span class="nb">Get-ImdbMovie</span>
<span class="p">{</span>
    <span class="p">[</span><span class="k">CmdletBinding</span><span class="p">()]</span>
    <span class="k">Param</span>
    <span class="p">(</span>
        <span class="c"># Enter the title of the movie you want to get information about</span>
        <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$true</span><span class="p">,</span>
                   <span class="k">ValueFromPipelineByPropertyName</span><span class="p">=</span><span class="nv">$true</span><span class="p">,</span>
                   <span class="k">Position</span><span class="p">=</span><span class="n">0</span><span class="p">)]</span>
        <span class="p">[</span><span class="n">ValidateNotNullorEmpty</span><span class="p">()]</span>
        <span class="no">[string]</span><span class="nv">$Title</span>
    <span class="p">)</span>
    <span class="k">Process</span> <span class="p">{</span> 
        <span class="c">#this is where the rest of the code goes</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>Replace any spaces with %20 so that we can use it in an URL. Other special characters could be replaced as well, but in this case we only handle spaces</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$searchTitle</span> <span class="p">=</span> <span class="nv">$Title</span><span class="p">.</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;%20&#39;</span><span class="p">)</span>
</code></pre></div><h2 id="parse-search-results">Parse search results</h2>
<p>Now lets fetch the search page on IMDB.com with the title in the URL.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$imdbURL</span> <span class="p">=</span> <span class="s2">&#34;http://www.imdb.com/search/title?title=$searchTitle&amp;title_type=feature&#34;</span>
<span class="nv">$moviesearch</span> <span class="p">=</span> <span class="nb">Invoke-WebRequest</span> <span class="nv">$imdbURL</span>
</code></pre></div><p>The entire web page is now stored in the $moviesearch variable. In the HTML on the IMDB site there is a class called &ldquo;title&rdquo; which we want to get.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$titleclassarray</span> <span class="p">=</span> <span class="nv">$moviesearch</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> <span class="nb">where </span><span class="n">Class</span> <span class="o">-eq</span> <span class="s1">&#39;title&#39;</span> <span class="p">|</span> <span class="nb">select </span><span class="n">-First</span> <span class="n">1</span>
</code></pre></div><p>If the search did not match any movies, then the &ldquo;title&rdquo; class shouldnt exist and the $titleclassarray will be empty. Check if the array contains anything useful. If it does, then we can continue, otherwise just break the script. Lets double check just to be sure.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="k">try</span> <span class="p">{</span>
       <span class="nv">$titleclass</span> <span class="p">=</span> <span class="nv">$titleclassarray</span><span class="p">[</span><span class="n">0</span><span class="p">]</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">{</span>
      <span class="nb">Write-Warning</span> <span class="s2">&#34;No movie found matching that title.
</span><span class="s2">      break
</span><span class="s2">}
</span><span class="s2">         
</span><span class="s2">if (!($titleclass)){
</span><span class="s2">      Write-Warning &#34;</span><span class="n">No</span> <span class="n">movie</span> <span class="n">found</span> <span class="n">matching</span> <span class="n">that</span> <span class="n">title</span><span class="p">.</span>
      <span class="k">break</span>
<span class="p">}</span>
</code></pre></div><p>Now we want to get the link to the main page for the first movie in the search result. First we use some regular expression to parse the HTML to find all links. The regexp expression filters out all href tags and gets the URL in those tags. All the links found will be stored in the $linksfound variable.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$regex</span> <span class="p">=</span> <span class="s2">&#34;&lt;\s*a\s*[^&gt;]*?href\s*=\s*[</span><span class="se">`&#34;</span><span class="s2">&#39;]*([^</span><span class="se">`&#34;</span><span class="s2">&#39;&gt;]+)[^&gt;]*?&gt;&#34;</span>
<span class="nv">$linksFound</span> <span class="p">=</span> <span class="no">[Regex]</span><span class="p">::</span><span class="n">Matches</span><span class="p">(</span><span class="nv">$titleclass</span><span class="p">.</span><span class="n">innerHTML</span><span class="p">,</span> <span class="nv">$regex</span><span class="p">,</span> <span class="s2">&#34;IgnoreCase&#34;</span><span class="p">)</span>
</code></pre></div><p>Any link to a movie page will contain the string &ldquo;/title/&rdquo; in the URL, so lets parse through all the links to see if we can find any link with that string. The results will be saved in the variable $titlelink.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$titlelink</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">ArrayList</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$link</span> <span class="k">in</span> <span class="nv">$linksFound</span><span class="p">)</span>
<span class="p">{</span>
     <span class="nv">$trimmedlink</span> <span class="p">=</span> <span class="nv">$link</span><span class="p">.</span><span class="n">Groups</span><span class="p">[</span><span class="n">1</span><span class="p">].</span><span class="n">Value</span><span class="p">.</span><span class="n">Trim</span><span class="p">()</span>
     <span class="k">if</span> <span class="p">(</span><span class="nv">$trimmedlink</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="s1">&#39;/title/&#39;</span><span class="p">))</span> 
     <span class="p">{</span>
           <span class="no">[void]</span> <span class="nv">$titlelink</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="nv">$trimmedlink</span><span class="p">)</span>
     <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h2 id="parse-movie-page">Parse movie page</h2>
<p>Next we want to fetch the real movie page from IMDB. The first string in $titlelink will be added to <a href="http://www.imdb.com">www.imdb.com</a>. Lets fetch it in english, to make it easier. Change this to any language you want.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$movieURL</span> <span class="p">=</span> <span class="s2">&#34;http://www.imdb.com</span><span class="p">$(</span><span class="nv">$titlelink</span><span class="p">[</span><span class="n">0</span><span class="p">])</span><span class="s2">&#34;</span>
<span class="nv">$moviehtml</span> <span class="p">=</span> <span class="nb">Invoke-WebRequest</span> <span class="nv">$movieURL</span> <span class="n">-Headers</span> <span class="p">@{</span><span class="s2">&#34;Accept-Language&#34;</span><span class="p">=</span><span class="s2">&#34;en-US,en;&#34;</span><span class="p">}</span>
</code></pre></div><p>Now the html for the movie page is stored in $moviehtml variable. Again we need to parse through the html to get the information we want. Next, create the movie object. This is what will be returned to the pipeline in the end.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$movie</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">-TypeName</span> <span class="n">psobject</span>
</code></pre></div><p>Search through the HTML for a tag which uses the class called &lsquo;itemprop&rsquo;. If we use the innerText method we will get the text within that tab. This is where the title is. Add the title to the $movie object.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="p">`</span>
            <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="p">`</span>
            <span class="n">-Name</span> <span class="s2">&#34;Title&#34;</span> <span class="n">-Value</span> <span class="p">`</span>
            <span class="p">(</span><span class="nv">$moviehtml</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> <span class="nb">where </span><span class="n">Class</span> <span class="o">-eq</span> <span class="s1">&#39;itemprop&#39;</span> <span class="p">|</span> <span class="nb">select </span><span class="n">-First</span> <span class="n">1</span><span class="p">).</span><span class="n">innerText</span>
</code></pre></div><p>Continue to search through the html for the other information that we want.
Directors is a bit more tricky. Its in a tag using the class &ldquo;txt-block&rdquo; but that class is used in more places so we need to dig a bit deeper and try to find a H4 tag with the class &ldquo;inline&rdquo; which actually contains the text &ldquo;Director:&rdquo;. Then we need to remove some html tags around the text that we want to save.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="k">foreach</span> <span class="p">(</span><span class="nv">$line</span> <span class="k">in</span> <span class="p">(</span><span class="nv">$moviehtml</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> <span class="nb">where </span><span class="n">Class</span> <span class="o">-eq</span> <span class="s1">&#39;txt-block&#39;</span><span class="p">).</span><span class="n">InnerHTML</span> <span class="n">-split</span> <span class="s2">&#34;</span><span class="se">`n</span><span class="s2">&#34;</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">-like</span> <span class="s1">&#39;*Director:*&#39;</span><span class="p">){</span>
        <span class="nv">$line</span> <span class="p">=</span> <span class="nv">$line</span><span class="p">.</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39;&lt;/SPAN&gt;&lt;/A&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="p">`</span>
                   <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="p">`</span>
                   <span class="n">-Name</span> <span class="s2">&#34;Directors&#34;</span> <span class="p">`</span>
                   <span class="n">-Value</span> <span class="nv">$line</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">0</span><span class="p">,</span><span class="nv">$line</span><span class="p">.</span><span class="n">LastIndexOf</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)+</span><span class="n">1</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>We continue like this to parse out what we need for the rest of the information.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># Year can be found in the tag using a class called &#34;nobr&#34; where we select the first result</span>
<span class="c"># and then remove some parantheses.</span>
<span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="p">`</span>
           <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="p">`</span>
           <span class="n">-Name</span> <span class="s2">&#34;Year&#34;</span> <span class="p">`</span>
           <span class="n">-Value</span> <span class="p">((</span><span class="nv">$moviehtml</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> 
                    <span class="nb">where </span><span class="n">Class</span> <span class="o">-eq</span> <span class="s1">&#39;nobr&#39;</span> <span class="p">|</span> 
                    <span class="nb">select </span><span class="n">-First</span> <span class="n">1</span><span class="p">).</span><span class="n">innerText</span><span class="p">).</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
 
<span class="c"># Rating can be found in the tag using the class &#34;titlePageSprite star-box-giga-star&#34;</span>
<span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="p">`</span>
           <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="p">`</span>
           <span class="n">-Name</span> <span class="s2">&#34;Rating&#34;</span>
           <span class="n">-Value</span> <span class="p">(</span><span class="nv">$moviehtml</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> 
                    <span class="nb">where </span><span class="n">Class</span> <span class="o">-eq</span> <span class="s1">&#39;titlePageSprite star-box-giga-star&#39;</span> <span class="p">|</span> 
                    <span class="nb">select </span><span class="n">-First</span> <span class="n">1</span><span class="p">).</span><span class="n">innerText</span>
 
<span class="c"># Description can be found in the tag using the class &#34;description&#34;</span>
<span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="p">`</span>
           <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="p">`</span>
           <span class="n">-Name</span> <span class="s2">&#34;Description&#34;</span> <span class="p">`</span>
           <span class="n">-Value</span> <span class="p">(</span><span class="nv">$moviehtml</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> 
                    <span class="nb">where </span><span class="n">itemprop</span> <span class="o">-eq</span> <span class="s1">&#39;description&#39;</span> <span class="p">|</span> 
                    <span class="nb">select </span><span class="n">-first</span> <span class="n">1</span><span class="p">).</span><span class="n">InnerText</span>
 
<span class="c"># Writers</span>
<span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="p">`</span>
           <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="p">`</span>
           <span class="n">-Name</span> <span class="s2">&#34;Writers&#34;</span> <span class="p">`</span>
           <span class="n">-Value</span> <span class="p">(</span><span class="nv">$moviehtml</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> 
                    <span class="nb">where </span><span class="n">itemprop</span> <span class="o">-eq</span> <span class="s1">&#39;creator&#39;</span> <span class="p">|</span> 
                    <span class="nb">select </span><span class="n">-first</span> <span class="n">1</span><span class="p">).</span><span class="n">InnerText</span><span class="p">.</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39;Writers:&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39; »&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
 
<span class="c"># Stars</span>
<span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="p">`</span>
           <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="p">`</span>
           <span class="n">-Name</span> <span class="s2">&#34;Stars&#34;</span> <span class="p">`</span>
           <span class="n">-Value</span> <span class="p">(</span><span class="nv">$moviehtml</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> 
                    <span class="nb">where </span><span class="n">itemprop</span> <span class="o">-eq</span> <span class="s1">&#39;actors&#39;</span><span class="p">).</span><span class="n">InnerText</span><span class="p">.</span><span class="n">Replace</span><span class="p">(</span>
                             <span class="s1">&#39;Stars:&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39; | See full cast and crew »&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</code></pre></div><p>The last thing we want to add to the object is the link to the page where the information comes from. After that the object can be returned to the pipeline.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="n">-Name</span> <span class="s2">&#34;Link&#34;</span> <span class="n">-Value</span> <span class="nv">$movieURL</span>
<span class="nv">$movie</span>
</code></pre></div><h2 id="complete-cmdlet-with-verbose-output">Complete cmdlet with verbose output</h2>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="cm">&lt;#
</span><span class="cm"></span><span class="sd">.Synopsis</span><span class="cm">
</span><span class="cm">   This scripts will get some basic information from IMDB about a movie by parcing the html code on the website.
</span><span class="cm"></span><span class="sd">.DESCRIPTION</span><span class="cm">
</span><span class="cm">   This scripts will get some basic information from IMDB about a movie by parcing the html code on the website.
</span><span class="cm"></span><span class="sd">.EXAMPLE</span><span class="cm">
</span><span class="cm">   Get-ImdbMovie -Title &#39;star trek&#39;
</span><span class="cm"></span><span class="sd">.EXAMPLE</span><span class="cm">
</span><span class="cm">   Get-ImdbMovie -Title &#39;star trek&#39; -verbose
</span><span class="cm"></span><span class="sd">.NOTES</span><span class="cm">
</span><span class="cm">   Created by John Roos
</span><span class="cm">   http://blog.roostech.se
</span><span class="cm">#&gt;</span>
<span class="k">function</span> <span class="nb">Get-ImdbMovie</span>
<span class="p">{</span>
    <span class="p">[</span><span class="k">CmdletBinding</span><span class="p">()]</span>
    <span class="k">Param</span>
    <span class="p">(</span>
        <span class="c"># Enter the title of the movie you want to get information about</span>
        <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$true</span><span class="p">,</span>
                   <span class="k">ValueFromPipelineByPropertyName</span><span class="p">=</span><span class="nv">$true</span><span class="p">,</span>
                   <span class="k">Position</span><span class="p">=</span><span class="n">0</span><span class="p">)]</span>
        <span class="p">[</span><span class="n">ValidateNotNullorEmpty</span><span class="p">()]</span>
        <span class="no">[string]</span><span class="nv">$Title</span>
    <span class="p">)</span>
 
    <span class="k">Process</span>
    <span class="p">{</span>
        <span class="nv">$searchTitle</span> <span class="p">=</span> <span class="nv">$Title</span><span class="p">.</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;%20&#39;</span><span class="p">)</span>
 
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Fetching search results&#34;</span>
        <span class="nv">$moviesearch</span> <span class="p">=</span> <span class="nb">Invoke-WebRequest</span> <span class="s2">&#34;http://www.imdb.com/search/title?title=$searchTitle&amp;title_type=feature&#34;</span>
         
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Moving html elements into variable&#34;</span>
        <span class="nv">$titleclassarray</span> <span class="p">=</span> <span class="nv">$moviesearch</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> <span class="nb">where </span><span class="n">Class</span> <span class="o">-eq</span> <span class="s1">&#39;title&#39;</span> <span class="p">|</span> <span class="nb">select </span><span class="n">-First</span> <span class="n">1</span>
         
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Checking if result contains movies&#34;</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nv">$titleclass</span> <span class="p">=</span> <span class="nv">$titleclassarray</span><span class="p">[</span><span class="n">0</span><span class="p">]</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nb">Write-Warning</span> <span class="s2">&#34;No movie found matching that title http://www.imdb.com/search/title?title=$searchTitle&amp;title_type=feature&#34;</span>
            <span class="k">break</span>
        <span class="p">}</span>
         
        <span class="k">if</span> <span class="p">(!(</span><span class="nv">$titleclass</span><span class="p">)){</span>
            <span class="nb">Write-Warning</span> <span class="s2">&#34;No movie found matching that title http://www.imdb.com/search/title?title=$searchTitle&amp;title_type=feature&#34;</span>
            <span class="k">break</span>
        <span class="p">}</span>
         
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Result contains movies.&#34;</span>
         
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Parcing HTML for movie link.&#34;</span>
        <span class="nv">$regex</span> <span class="p">=</span> <span class="s2">&#34;&lt;\s*a\s*[^&gt;]*?href\s*=\s*[</span><span class="se">`&#34;</span><span class="s2">&#39;]*([^</span><span class="se">`&#34;</span><span class="s2">&#39;&gt;]+)[^&gt;]*?&gt;&#34;</span>
        <span class="nv">$linksFound</span> <span class="p">=</span> <span class="no">[Regex]</span><span class="p">::</span><span class="n">Matches</span><span class="p">(</span><span class="nv">$titleclass</span><span class="p">.</span><span class="n">innerHTML</span><span class="p">,</span> <span class="nv">$regex</span><span class="p">,</span> <span class="s2">&#34;IgnoreCase&#34;</span><span class="p">)</span>
         
        <span class="nv">$titlelink</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">ArrayList</span>
        <span class="k">foreach</span><span class="p">(</span><span class="nv">$link</span> <span class="k">in</span> <span class="nv">$linksFound</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nv">$trimmedlink</span> <span class="p">=</span> <span class="nv">$link</span><span class="p">.</span><span class="n">Groups</span><span class="p">[</span><span class="n">1</span><span class="p">].</span><span class="n">Value</span><span class="p">.</span><span class="n">Trim</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$trimmedlink</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="s1">&#39;/title/&#39;</span><span class="p">))</span> <span class="p">{</span>
                <span class="no">[void]</span> <span class="nv">$titlelink</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="nv">$trimmedlink</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Movie link found.&#34;</span>
 
        <span class="nv">$movieURL</span> <span class="p">=</span> <span class="s2">&#34;http://www.imdb.com</span><span class="p">$(</span><span class="nv">$titlelink</span><span class="p">[</span><span class="n">0</span><span class="p">])</span><span class="s2">&#34;</span>
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Fetching movie page.&#34;</span>
        <span class="nv">$moviehtml</span> <span class="p">=</span> <span class="nb">Invoke-WebRequest</span> <span class="nv">$movieURL</span> <span class="n">-Headers</span> <span class="p">@{</span><span class="s2">&#34;Accept-Language&#34;</span><span class="p">=</span><span class="s2">&#34;en-US,en;&#34;</span><span class="p">}</span>
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Movie page fetched.&#34;</span>
 
        <span class="nv">$movie</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">-TypeName</span> <span class="n">psobject</span>
 
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Parcing for title.&#34;</span>
        <span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="n">-Name</span> <span class="s2">&#34;Title&#34;</span> <span class="n">-Value</span> <span class="p">(</span><span class="nv">$moviehtml</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> <span class="nb">where </span><span class="n">Class</span> <span class="o">-eq</span> <span class="s1">&#39;itemprop&#39;</span> <span class="p">|</span> <span class="nb">select </span><span class="n">-First</span> <span class="n">1</span><span class="p">).</span><span class="n">innerText</span>
 
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Parcing for directors.&#34;</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$line</span> <span class="k">in</span> <span class="p">(</span><span class="nv">$moviehtml</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> <span class="nb">where </span><span class="n">Class</span> <span class="o">-eq</span> <span class="s1">&#39;txt-block&#39;</span><span class="p">).</span><span class="n">InnerHTML</span> <span class="n">-split</span> <span class="s2">&#34;</span><span class="se">`n</span><span class="s2">&#34;</span><span class="p">){</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">-like</span> <span class="s1">&#39;*Director:*&#39;</span><span class="p">){</span>
                <span class="nv">$line</span> <span class="p">=</span> <span class="nv">$line</span><span class="p">.</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39;&lt;/SPAN&gt;&lt;/A&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="n">-Name</span> <span class="s2">&#34;Directors&#34;</span> <span class="n">-Value</span> <span class="nv">$line</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">0</span><span class="p">,</span><span class="nv">$line</span><span class="p">.</span><span class="n">LastIndexOf</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)+</span><span class="n">1</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
 
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Parcing for year.&#34;</span>
        <span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="n">-Name</span> <span class="s2">&#34;Year&#34;</span> <span class="n">-Value</span> <span class="p">((</span><span class="nv">$moviehtml</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> <span class="nb">where </span><span class="n">Class</span> <span class="o">-eq</span> <span class="s1">&#39;nobr&#39;</span> <span class="p">|</span> <span class="nb">select </span><span class="n">-First</span> <span class="n">1</span><span class="p">).</span><span class="n">innerText</span><span class="p">).</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
 
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Parcing for rating.&#34;</span>
        <span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="n">-Name</span> <span class="s2">&#34;Rating&#34;</span> <span class="n">-Value</span> <span class="p">(</span><span class="nv">$moviehtml</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> <span class="nb">where </span><span class="n">Class</span> <span class="o">-eq</span> <span class="s1">&#39;titlePageSprite star-box-giga-star&#39;</span> <span class="p">|</span> <span class="nb">select </span><span class="n">-First</span> <span class="n">1</span><span class="p">).</span><span class="n">innerText</span>
 
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Parcing for description.&#34;</span>
        <span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="n">-Name</span> <span class="s2">&#34;Description&#34;</span> <span class="n">-Value</span> <span class="p">(</span><span class="nv">$moviehtml</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> <span class="nb">where </span><span class="n">itemprop</span> <span class="o">-eq</span> <span class="s1">&#39;description&#39;</span> <span class="p">|</span> <span class="nb">select </span><span class="n">-first</span> <span class="n">1</span><span class="p">).</span><span class="n">InnerText</span>
 
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Parcing for writers.&#34;</span>
        <span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="n">-Name</span> <span class="s2">&#34;Writers&#34;</span> <span class="n">-Value</span> <span class="p">(</span><span class="nv">$moviehtml</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> <span class="nb">where </span><span class="n">itemprop</span> <span class="o">-eq</span> <span class="s1">&#39;creator&#39;</span> <span class="p">|</span> <span class="nb">select </span><span class="n">-first</span> <span class="n">1</span><span class="p">).</span><span class="n">InnerText</span><span class="p">.</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39;Writers:&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39; »&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
 
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Parcing for stars.&#34;</span>
        <span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="n">-Name</span> <span class="s2">&#34;Stars&#34;</span> <span class="n">-Value</span> <span class="p">(</span><span class="nv">$moviehtml</span><span class="p">.</span><span class="n">AllElements</span> <span class="p">|</span> <span class="nb">where </span><span class="n">itemprop</span> <span class="o">-eq</span> <span class="s1">&#39;actors&#39;</span><span class="p">).</span><span class="n">InnerText</span><span class="p">.</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39;Stars:&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="n">Replace</span><span class="p">(</span><span class="s1">&#39; | See full cast and crew »&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
 
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Adding the link.&#34;</span>
        <span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$movie</span> <span class="n">-MemberType</span> <span class="s1">&#39;NoteProperty&#39;</span> <span class="n">-Name</span> <span class="s2">&#34;Link&#34;</span> <span class="n">-Value</span> <span class="nv">$movieURL</span>
 
        <span class="nb">Write-Verbose</span> <span class="s2">&#34;Returning object.&#34;</span>
        <span class="nv">$movie</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

                <p>- Written by John  
                
                    
                    
                    on March 4, 2015</p>

                
                    <div class="disqus-section">
                        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "blog-roostech-se" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                    </div>
                
            </div>

       </div>
    


            </div>
        </div>
    </body>
</html>
