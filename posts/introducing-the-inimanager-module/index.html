 
 

 

 

 

 

 


<!DOCTYPE html>
<html lang="en">




    



<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.86, maximum-scale=5.0, minimum-scale=0.86">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/css/syntax.css">
    <link rel="stylesheet" type="text/css" href="/css/style.css">

    <meta name='twitter:card'        content='summary' />
    <meta name='twitter:site'        content='@johnmroos'/>
    <meta name='twitter:creator'     content='@johnmroos'/>
    <meta name='twitter:title'       content='Introducing the IniManager module' />
    <meta name='twitter:description' content='Some time ago I wanted to find a DSC resource which would help me in configuring ini files. I did not really find any resource which was dynamic enough for my needs so I ended up writing my own. Since I want my DSC resources to contain as little code as possible I prefer to create cmdlets outside of the resource which I can call from within the resource. In this way I can also use the cmdlets in scripts and the console which is a nice bonus.' />
    
    <meta name='twitter:domain'      content='https://blog.roostech.se/'/>
    

    <title>Introducing the IniManager module</title>
    <meta name="description" content="Some time ago I wanted to find a DSC resource which would help me in configuring ini files. I did not really find any resource which was dynamic enough for my needs so I ended up writing my own. Since I want my DSC resources to contain as little code as possible I prefer to create cmdlets outside of the resource which I can call from within the resource. In this way I can also use the cmdlets in scripts and the console which is a nice bonus."/>
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9F2VG64X4H"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-9F2VG64X4H', { 'anonymize_ip': false });
}
</script>

</head><body>
        <div class="container">
<input class="explorer-toggle" type="checkbox" id="explorer-toggle">
<label class="explorer-toggle-label" for="explorer-toggle"><div class="explorer-toggle-label-clickablearea"></div></label>

<div class="explorer-toggle-label-selection"></div>

<div class="left-menu-button-bar"></div>

<diV class='left-menu'>
    
    <ul class="root">
        <li class="root"><div class="menu-item folder open"><a class="menu-item-site" href="https://blog.roostech.se/">blog.roostech.se (HUGOVSCODE)</a></div>
            <ul>  
                <li><span class="menu-item folder open">content</span>
                    <ul>
                        <li><span class="menu-item folder open">posts</span>
                            <ul>
                                
                                <li ><a href="/posts/get-function-configuration-from-deployed-function-app/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Get function configuration from deployed Function App.md</span></a></li>
                                
                                <li ><a href="/posts/deploy-azure-function-app-without-downtime/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Deploy Azure Function App without downtime.md</span></a></li>
                                
                                <li ><a href="/posts/moving-from-blogger-to-github-pages-with-hugo/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Moving from Blogger to GitHub Pages using Hugo.md</span></a></li>
                                
                                <li ><a href="/posts/pester-5-discovery-and-testcases/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Pester 5: Discovery and TestCases.md</span></a></li>
                                
                                <li ><a href="/posts/create-and-use-azure-table-storage-with-powershell/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Create and use Azure Table storage with PowerShell.md</span></a></li>
                                
                                <li ><a href="/posts/use-edit-command-to-discover-the-code-behind-built-in-cmdlets/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Use Edit-Command to discover the code behind built-in cmdlets.md</span></a></li>
                                
                                <li ><a href="/posts/invoke-restmethod-with-anti-forgery-tokens-in-header-and-cookie/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Invoke-RestMethod with anti-forgery tokens in header and cookie.md</span></a></li>
                                
                                <li class="current"><a href="/posts/introducing-the-inimanager-module/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Introducing the IniManager module.md</span></a></li>
                                
                                <li ><a href="/posts/use-powershell-jobs-to-ping-many-from-many-with-log/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Use PowerShell jobs to ping many from many with log.md</span></a></li>
                                
                                <li ><a href="/posts/powershell-logo-made-with-css3/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">PowerShell logo made with CSS3.md</span></a></li>
                                
                                <li ><a href="/posts/what-is-this-here-string-people-are-talking-about/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">What is this here-string people are talking about?.md</span></a></li>
                                
                                <li ><a href="/posts/dynamic-parameters-in-powershell-executes-before-you-know-it/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Dynamic parameters in PowerShell executes before you know it.md</span></a></li>
                                
                                <li ><a href="/posts/making-powershell-expressions-easier/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Making PowerShell expressions easier.md</span></a></li>
                                
                                <li ><a href="/posts/simple-select-from-database-with-powershell/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Simple select from database with PowerShell.md</span></a></li>
                                
                                <li ><a href="/posts/how-to-use-splatting-in-powershell/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">How to use splatting in PowerShell.md</span></a></li>
                                
                                <li ><a href="/posts/get-imdbmovie-using-invoke-webrequest/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Get-IMDBmovie using Invoke-WebRequest.md</span></a></li>
                                
                                <li ><a href="/posts/classes-in-powershell-5.0/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Classes in Powershell 5.0.md</span></a></li>
                                
                                <li ><a href="/posts/how-to-get-started-with-powershell/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">How to get started with Powershell.md</span></a></li>
                                
                                <li ><a href="/posts/powershell-script-find-hotfix-status/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Powershell script: Find hotfix status.md</span></a></li>
                                
                                <li ><a href="/posts/powershell-script-write-object-to-sql/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Powershell script: Write object to SQL.md</span></a></li>
                                
                                <li ><a href="/posts/get-type-alternative-for-null-values/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Get-Type alternative for $null values.md</span></a></li>
                                
                                <li ><a href="/posts/compress-files-to-zip-with-powershell/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Compress files to Zip with Powershell.md</span></a></li>
                                
                                <li ><a href="/posts/enable-real-time-jmx-monitoring-in-cognos/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Enable real time JMX monitoring in Cognos.md</span></a></li>
                                
                                <li ><a href="/posts/move-data-or-log-files-for-tempdb-in-sql-server/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Move data or log files for TempDB in SQL Server.md</span></a></li>
                                
                                <li ><a href="/posts/resources-for-remotefx-in-windows-server-2012/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Resources for RemoteFX in Windows Server 2012.md</span></a></li>
                                
                                <li ><a href="/posts/rdp-8.0-for-windows-7-sp1/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">RDP 8.0 for Windows 7 SP1.md</span></a></li>
                                
                                <li ><a href="/posts/improving-remotefx-performance-in-hyper-v/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Improving RemoteFX performance in Hyper-V.md</span></a></li>
                                
                                <li ><a href="/posts/configure-remotefx-in-hyper-v-running-windows-server-2012-with-low-end-gpu/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Configure RemoteFX in Hyper-V running Windows Server 2012 with low end GPU.md</span></a></li>
                                
                                <li ><a href="/posts/sqlps-and-its-limitations/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">SQLPS and its limitations.md</span></a></li>
                                
                                <li ><a href="/posts/script-deployment-of-ssis-packages-from-folder/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Script deployment of SSIS packages from folder.md</span></a></li>
                                
                                <li ><a href="/posts/dynamic-deploy-of-ssrs-reports-using-rs.exe/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Dynamic deploy of SSRS reports using rs.exe.md</span></a></li>
                                
                                <li ><a href="/posts/remove-headers-in-excel-exports-to-fix-column-alignment/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Remove headers in Excel exports to fix column alignment.md</span></a></li>
                                
                                <li ><a href="/posts/using-executionlog2-for-statistics-and-monitoring/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Using ExecutionLog2 for statistics and monitoring.md</span></a></li>
                                
                            </ul>
                        </li>
                        <li><span class="menu-item folder open">pages</span>
                            <ul>
                                
                                <li ><a href="/about/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">About me.md</span></a></li>
                                
                                <li ><a href="/chroma/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Chroma.md</span></a></li>
                                
                            </ul>
                        </li>
                    </ul>
                </li>
                <li><span class="menu-item folder">data</span></li>
                <li><span class="menu-item folder">layouts</span></li>
                <li><span class="menu-item folder">resources</span></li>
                <li><span class="menu-item folder">static</span></li>
                <li><span class="menu-item folder open">themes</span>
                    <ul>
                        <li><span class="menu-item folder open">hugovscode</span>
                            <ul>
                                <li><a href="https://github.com/JohnRoos/HugoVSCode/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">.git</span></a></li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li>config.toml</li>
            </ul>
        </li>
    </ul>
  

    
</diV>
                <div class ="main-tabs">
                    <div class="main-tab">
                        <span class="rotate-letter md-icon">&#10144;</span> <a href="/">Home.md</a> 
                    </div>
                
                    <div class="main-tab current">
                        <span class="rotate-letter md-icon">&#10144;</span> <i>Introducing the IniManager module.md</i> 
                    </div>
                
                
                    <div class="main-tab">
                        <span class="rotate-letter md-icon">&#10144;</span> <a href="/posts/get-function-configuration-from-deployed-function-app/">Get function configuration from deployed Function App.md</a>
                    </div>
                
                    <div class="main-tab">
                        <span class="rotate-letter md-icon">&#10144;</span> <a href="/posts/deploy-azure-function-app-without-downtime/">Deploy Azure Function App without downtime.md</a>
                    </div>
                
                    <div class="main-tab">
                        <span class="rotate-letter md-icon">&#10144;</span> <a href="/posts/moving-from-blogger-to-github-pages-with-hugo/">Moving from Blogger to GitHub Pages using Hugo.md</a>
                    </div>
                
                    <div class="main-tab">
                        <span class="rotate-letter md-icon">&#10144;</span> <a href="/posts/pester-5-discovery-and-testcases/">Pester 5: Discovery and TestCases.md</a>
                    </div>
                
                    <div class="main-tab">
                        <span class="rotate-letter md-icon">&#10144;</span> <a href="/posts/create-and-use-azure-table-storage-with-powershell/">Create and use Azure Table storage with PowerShell.md</a>
                    </div>
                
                </div>
            
            
            <div class='main'>
    <div class="main-path">
        <span><a class="path-link" href="https://blog.roostech.se/">blog.roostech.se</a></span><span class="folder">content</span><span class="folder">posts</span><span class="folder">Introducing the IniManager module.md</span>
        
                
                
                <span class="postdate-container">&nbsp;(<time class="postdate" datetime="2016-04-23">April 23, 2016</time>)</span>
            
    </div>
    
    <div class="main-content-toggle">

        
        <input class="source-preview-split" type="checkbox" id="source-preview-split-toggle">
        <label class="source-preview-split-label" for="source-preview-split-toggle"></label>

        <input class="source-toggle" type="checkbox" id="source-toggle">
        <label class="source-toggle-label" for="source-toggle"></label>

        <div class="main-content">
            ---<br />
            <span class="md-frontmatter">title</span>: <span class="md-frontmatter-string">Introducing the IniManager module</span><br />
            <span class="md-frontmatter">date</span>: 2016-04-23 14:14:00 &#43;0200 CEST<br />
            <span class="md-frontmatter">draft</span>: <span class="md-frontmatter">false</span><br />
            <span class="md-frontmatter">author</span>: <span class="md-frontmatter-string">John</span><br />
            ----
            <p>Some time ago I wanted to find a DSC resource which would help me in configuring ini files. I did not really find any resource which was dynamic enough for my needs so I ended up writing my own. Since I want my DSC resources to contain as little code as possible I prefer to create cmdlets outside of the resource which I can call from within the resource. In this way I can also use the cmdlets in scripts and the console which is a nice bonus.</p>
<p>I also wanted to be able to use both strings and hash tables as input depending on my needs. In this way I would be able to create very dynamic resources and if I need more static resources I can always create composite resources. I ended up with a module which contains seven cmdlets to create, modify and verify ini files.</p>
<p>The IniManager module contains the following cmdlets:</p>
<ul>
<li>Get-Ini</li>
<li>New-Ini</li>
<li>Remove-IniKey</li>
<li>Rename-IniKey</li>
<li>Set-IniFromHash</li>
<li>Set-IniKey</li>
<li>Test-Ini</li>
</ul>
<p>Note that comments in ini files are not handled. If you use this module to create or modify an ini file any comments in that file will be removed. The only case in which a comment is kept is if it contains &ldquo;=&rdquo; on that row. The functions check for &ldquo;=&rdquo; on each row to separate between key and value.</p>
<h2 id="the-fileini-object">The File.Ini object</h2>
<p>For all the cmdlets in this module I created a custom object which has the type name File.Ini. This object type contains one property per section with the same naming convention as in ini files. This means that the property names have brackets around them. The object also contains one property for each key/value pair which does not belong to a section. These properties will not have brackets around them.</p>
<p>The section properties (with brackets) are of the type File.Ini.Config which in turn contains a collection of properties. One property per key/value in that section.</p>
<p>It&rsquo;s probably easier to explain the object with an example. In this example I use Get-Ini to read the content from an ini file and pipe that to Get-Member. The ini file looks like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ImportPath=c:\import
</span></span><span class="line"><span class="cl">ExportPath=c:\export
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">[logging]
</span></span><span class="line"><span class="cl">Path=c:\log
</span></span><span class="line"><span class="cl">LogLevel=Error
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">[drivers]
</span></span><span class="line"><span class="cl">wave=mmdrv.dll
</span></span><span class="line"><span class="cl">timer=timer.drv
</span></span></code></pre></div><p>Running the command in the console will output an object which looks like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">PS C:\&gt; Get-Ini -Path C:\temp\myconfig.ini | Get-Member
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   TypeName: File.ini
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Name        MemberType   Definition                                                   
</span></span><span class="line"><span class="cl">----        ----------   ----------                                                   
</span></span><span class="line"><span class="cl">Equals      Method       bool Equals(System.Object obj)                               
</span></span><span class="line"><span class="cl">GetHashCode Method       int GetHashCode()                                            
</span></span><span class="line"><span class="cl">GetType     Method       type GetType()                                               
</span></span><span class="line"><span class="cl">ToString    Method       string ToString()                                            
</span></span><span class="line"><span class="cl">ExportPath  NoteProperty string ExportPath=c:\export                                  
</span></span><span class="line"><span class="cl">ImportPath  NoteProperty string ImportPath=c:\import                                  
</span></span><span class="line"><span class="cl">[drivers]   NoteProperty File.ini.Section [drivers]=@{wave=mmdrv.dll; timer=timer.drv}
</span></span><span class="line"><span class="cl">[logging]   NoteProperty File.Ini.Config [logging]=@{LogLevel=Error; Path=c:\log}
</span></span></code></pre></div><p>That&rsquo;s the object we are dealing with. Now, let&rsquo;s look at the cmdlets available in the module.</p>
<h2 id="get-ini">Get-Ini</h2>
<p>When I do this kind of thing I usually start with the basics. This cmdlet reads an ini file from disk and outputs the custom object. Its used by most of the other cmdlets so it makes the basics for the entire module. Here is an example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Get-Ini</span> <span class="n">-Path</span> <span class="s2">&#34;C:\config.ini&#34;</span>
</span></span></code></pre></div><h2 id="new-ini">New-Ini</h2>
<p>This cmdlet, as the name suggests, creates an ini file on disk. It requires a File.Ini object so the easiest thing to do is to create a File.Ini object first and them pipe that to this cmdlet. One way to do that is to use Get-Ini. You could modify the object before sending it to New-Ini, but in this example I will just create the object from an existing ini file and create it in a new path.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Get-Ini</span> <span class="n">-Path</span> <span class="s2">&#34;C:\config.ini&#34;</span> <span class="p">|</span> <span class="nb">new-ini</span> <span class="n">-Path</span> <span class="n">c:</span><span class="p">\</span><span class="n">config_new</span><span class="p">.</span><span class="py">ini</span> <span class="n">-Encoding</span> <span class="n">UTF8</span>
</span></span></code></pre></div><h2 id="set-inikey">Set-IniKey</h2>
<p>So now we have covered the basics. If we would want to change certain configuration values in an ini file there are several options on how to do that. One easy way is to use Set-IniKey, which is used to change a value in an ini file. In this example we are changing the key &ldquo;LogLevel&rdquo; to &ldquo;Debug&rdquo;. The LogLevel is placed in the Logging section of the ini file so we also have to select the section. As an extra feature we also set the file encoding to UTF8 just for the hell of it.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Set-IniKey</span> <span class="n">-Path</span> <span class="s2">&#34;C:\config.ini&#34;</span> <span class="n">-Key</span> <span class="n">LoggingLevel</span> <span class="n">-Value</span> <span class="n">Debug</span> <span class="n">-Section</span> <span class="n">Logging</span> <span class="n">-Encoding</span> <span class="n">UTF8</span>
</span></span></code></pre></div><h2 id="remove-inikey">Remove-IniKey</h2>
<p>So we have tried to read an ini file, create a new one and modified a value. Now it&rsquo;s time for removing values in the ini file. This cmdlet works just as easy as the others. You simply use parameters to select the key and optionally you select the file encoding (the file have to be written after all). In this example we will remove a key (or configuration entry) which is called Proxy in the &ldquo;[system]&rdquo; section of the ini file. Again, the file encoding can be set as well.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Remove-IniKey</span> <span class="n">-Path</span> <span class="s2">&#34;c:\config.ini&#34;</span> <span class="n">-Key</span> <span class="p">[</span><span class="no">system</span><span class="p">]</span><span class="n">Proxy</span> <span class="n">-Encoding</span> <span class="n">ASCII</span>
</span></span></code></pre></div><h2 id="rename-inikey">Rename-IniKey</h2>
<p>There are occasions where a key needs to be renamed. One reason to change the name of a key could simply be to add a hash before it so that it becomes a comment and not read by the system. It could also be if a key was misspelled. In this example we will rename a key called &ldquo;Prixy&rdquo; to &ldquo;Proxy&rdquo; in the &ldquo;system&rdquo; section.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Rename-IniKey</span> <span class="n">-Path</span> <span class="n">c:</span><span class="p">\</span><span class="n">config</span><span class="p">.</span><span class="py">ini</span> <span class="n">-Key</span> <span class="n">Prixy</span> <span class="n">-NewKey</span> <span class="n">Proxy</span> <span class="n">-Section</span> <span class="n">system</span> <span class="n">-Encoding</span> <span class="n">UTF8</span>
</span></span></code></pre></div><h2 id="set-inifromhash">Set-IniFromHash</h2>
<p>Now we are getting into the interesting parts. What if you know exactly what you need to change in an ini file and you want to change all of it at once? This is the cmdlet you need for that. You simply create a hash table with the configuration you want and pass it in. In this example we will use a hash table to add two key/value pairs, one in a section and one without section. This works really well in DSC resources.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nv">$hash</span> <span class="p">=</span> <span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;DebugLog&#39;</span>          <span class="p">=</span><span class="s1">&#39;false&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;[settings]Hostname&#39;</span><span class="p">=</span><span class="s1">&#39;localhost&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="nb">Set-IniFromHash</span> <span class="n">-Path</span> <span class="n">c:</span><span class="p">\</span><span class="n">config</span><span class="p">.</span><span class="py">ini</span> <span class="n">-Values</span> <span class="nv">$hash</span> <span class="n">-Encoding</span> <span class="n">UTF8</span>
</span></span></code></pre></div><h2 id="test-ini">Test-Ini</h2>
<p>So now we have all the cmdlets to modify our ini files. What if we want to make sure that an ini file is set up in the correct way? This is the cmdlet for that. Simply pass in a hash table with your configuration and this cmdlet will output True or False. Test-Ini works really well in a DSC configuration as well. This example is uses the same hash table as Set-IniFromHash to check if the ini file has the correct settings.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nv">$hash</span> <span class="p">=</span> <span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;DebugLog&#39;</span>          <span class="p">=</span><span class="s1">&#39;false&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;[settings]Hostname&#39;</span><span class="p">=</span><span class="s1">&#39;localhost&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="nb">Test-Ini</span> <span class="n">-Path</span> <span class="s2">&#34;C:\config.ini&#34;</span> <span class="n">-Values</span> <span class="nv">$hash</span>
</span></span></code></pre></div><h2 id="where-to-download">Where to download</h2>
<p>This module is available in the <a href="https://www.powershellgallery.com/packages/IniManager">PowerShell Gallery</a> and <a href="https://gallery.technet.microsoft.com/scriptcenter/IniManager-2eb8cafd">Microsoft Script Center</a>. If you would like to see more examples, report a bug or contribute with more features, you can visit <a href="https://github.com/JohnRoos/PowerShell">my GitHub repository</a>.</p>

        </div>

        
        <div class="main-content-preview">
            <h1>Introducing the IniManager module</h1>
            
            <p>Some time ago I wanted to find a DSC resource which would help me in configuring ini files. I did not really find any resource which was dynamic enough for my needs so I ended up writing my own. Since I want my DSC resources to contain as little code as possible I prefer to create cmdlets outside of the resource which I can call from within the resource. In this way I can also use the cmdlets in scripts and the console which is a nice bonus.</p>
<p>I also wanted to be able to use both strings and hash tables as input depending on my needs. In this way I would be able to create very dynamic resources and if I need more static resources I can always create composite resources. I ended up with a module which contains seven cmdlets to create, modify and verify ini files.</p>
<p>The IniManager module contains the following cmdlets:</p>
<ul>
<li>Get-Ini</li>
<li>New-Ini</li>
<li>Remove-IniKey</li>
<li>Rename-IniKey</li>
<li>Set-IniFromHash</li>
<li>Set-IniKey</li>
<li>Test-Ini</li>
</ul>
<p>Note that comments in ini files are not handled. If you use this module to create or modify an ini file any comments in that file will be removed. The only case in which a comment is kept is if it contains &ldquo;=&rdquo; on that row. The functions check for &ldquo;=&rdquo; on each row to separate between key and value.</p>
<h2 id="the-fileini-object">The File.Ini object</h2>
<p>For all the cmdlets in this module I created a custom object which has the type name File.Ini. This object type contains one property per section with the same naming convention as in ini files. This means that the property names have brackets around them. The object also contains one property for each key/value pair which does not belong to a section. These properties will not have brackets around them.</p>
<p>The section properties (with brackets) are of the type File.Ini.Config which in turn contains a collection of properties. One property per key/value in that section.</p>
<p>It&rsquo;s probably easier to explain the object with an example. In this example I use Get-Ini to read the content from an ini file and pipe that to Get-Member. The ini file looks like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">ImportPath=c:\import
</span></span><span class="line"><span class="cl">ExportPath=c:\export
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">[logging]
</span></span><span class="line"><span class="cl">Path=c:\log
</span></span><span class="line"><span class="cl">LogLevel=Error
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">[drivers]
</span></span><span class="line"><span class="cl">wave=mmdrv.dll
</span></span><span class="line"><span class="cl">timer=timer.drv
</span></span></code></pre></div><p>Running the command in the console will output an object which looks like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">PS C:\&gt; Get-Ini -Path C:\temp\myconfig.ini | Get-Member
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   TypeName: File.ini
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Name        MemberType   Definition                                                   
</span></span><span class="line"><span class="cl">----        ----------   ----------                                                   
</span></span><span class="line"><span class="cl">Equals      Method       bool Equals(System.Object obj)                               
</span></span><span class="line"><span class="cl">GetHashCode Method       int GetHashCode()                                            
</span></span><span class="line"><span class="cl">GetType     Method       type GetType()                                               
</span></span><span class="line"><span class="cl">ToString    Method       string ToString()                                            
</span></span><span class="line"><span class="cl">ExportPath  NoteProperty string ExportPath=c:\export                                  
</span></span><span class="line"><span class="cl">ImportPath  NoteProperty string ImportPath=c:\import                                  
</span></span><span class="line"><span class="cl">[drivers]   NoteProperty File.ini.Section [drivers]=@{wave=mmdrv.dll; timer=timer.drv}
</span></span><span class="line"><span class="cl">[logging]   NoteProperty File.Ini.Config [logging]=@{LogLevel=Error; Path=c:\log}
</span></span></code></pre></div><p>That&rsquo;s the object we are dealing with. Now, let&rsquo;s look at the cmdlets available in the module.</p>
<h2 id="get-ini">Get-Ini</h2>
<p>When I do this kind of thing I usually start with the basics. This cmdlet reads an ini file from disk and outputs the custom object. Its used by most of the other cmdlets so it makes the basics for the entire module. Here is an example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Get-Ini</span> <span class="n">-Path</span> <span class="s2">&#34;C:\config.ini&#34;</span>
</span></span></code></pre></div><h2 id="new-ini">New-Ini</h2>
<p>This cmdlet, as the name suggests, creates an ini file on disk. It requires a File.Ini object so the easiest thing to do is to create a File.Ini object first and them pipe that to this cmdlet. One way to do that is to use Get-Ini. You could modify the object before sending it to New-Ini, but in this example I will just create the object from an existing ini file and create it in a new path.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Get-Ini</span> <span class="n">-Path</span> <span class="s2">&#34;C:\config.ini&#34;</span> <span class="p">|</span> <span class="nb">new-ini</span> <span class="n">-Path</span> <span class="n">c:</span><span class="p">\</span><span class="n">config_new</span><span class="p">.</span><span class="py">ini</span> <span class="n">-Encoding</span> <span class="n">UTF8</span>
</span></span></code></pre></div><h2 id="set-inikey">Set-IniKey</h2>
<p>So now we have covered the basics. If we would want to change certain configuration values in an ini file there are several options on how to do that. One easy way is to use Set-IniKey, which is used to change a value in an ini file. In this example we are changing the key &ldquo;LogLevel&rdquo; to &ldquo;Debug&rdquo;. The LogLevel is placed in the Logging section of the ini file so we also have to select the section. As an extra feature we also set the file encoding to UTF8 just for the hell of it.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Set-IniKey</span> <span class="n">-Path</span> <span class="s2">&#34;C:\config.ini&#34;</span> <span class="n">-Key</span> <span class="n">LoggingLevel</span> <span class="n">-Value</span> <span class="n">Debug</span> <span class="n">-Section</span> <span class="n">Logging</span> <span class="n">-Encoding</span> <span class="n">UTF8</span>
</span></span></code></pre></div><h2 id="remove-inikey">Remove-IniKey</h2>
<p>So we have tried to read an ini file, create a new one and modified a value. Now it&rsquo;s time for removing values in the ini file. This cmdlet works just as easy as the others. You simply use parameters to select the key and optionally you select the file encoding (the file have to be written after all). In this example we will remove a key (or configuration entry) which is called Proxy in the &ldquo;[system]&rdquo; section of the ini file. Again, the file encoding can be set as well.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Remove-IniKey</span> <span class="n">-Path</span> <span class="s2">&#34;c:\config.ini&#34;</span> <span class="n">-Key</span> <span class="p">[</span><span class="no">system</span><span class="p">]</span><span class="n">Proxy</span> <span class="n">-Encoding</span> <span class="n">ASCII</span>
</span></span></code></pre></div><h2 id="rename-inikey">Rename-IniKey</h2>
<p>There are occasions where a key needs to be renamed. One reason to change the name of a key could simply be to add a hash before it so that it becomes a comment and not read by the system. It could also be if a key was misspelled. In this example we will rename a key called &ldquo;Prixy&rdquo; to &ldquo;Proxy&rdquo; in the &ldquo;system&rdquo; section.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Rename-IniKey</span> <span class="n">-Path</span> <span class="n">c:</span><span class="p">\</span><span class="n">config</span><span class="p">.</span><span class="py">ini</span> <span class="n">-Key</span> <span class="n">Prixy</span> <span class="n">-NewKey</span> <span class="n">Proxy</span> <span class="n">-Section</span> <span class="n">system</span> <span class="n">-Encoding</span> <span class="n">UTF8</span>
</span></span></code></pre></div><h2 id="set-inifromhash">Set-IniFromHash</h2>
<p>Now we are getting into the interesting parts. What if you know exactly what you need to change in an ini file and you want to change all of it at once? This is the cmdlet you need for that. You simply create a hash table with the configuration you want and pass it in. In this example we will use a hash table to add two key/value pairs, one in a section and one without section. This works really well in DSC resources.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nv">$hash</span> <span class="p">=</span> <span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;DebugLog&#39;</span>          <span class="p">=</span><span class="s1">&#39;false&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;[settings]Hostname&#39;</span><span class="p">=</span><span class="s1">&#39;localhost&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="nb">Set-IniFromHash</span> <span class="n">-Path</span> <span class="n">c:</span><span class="p">\</span><span class="n">config</span><span class="p">.</span><span class="py">ini</span> <span class="n">-Values</span> <span class="nv">$hash</span> <span class="n">-Encoding</span> <span class="n">UTF8</span>
</span></span></code></pre></div><h2 id="test-ini">Test-Ini</h2>
<p>So now we have all the cmdlets to modify our ini files. What if we want to make sure that an ini file is set up in the correct way? This is the cmdlet for that. Simply pass in a hash table with your configuration and this cmdlet will output True or False. Test-Ini works really well in a DSC configuration as well. This example is uses the same hash table as Set-IniFromHash to check if the ini file has the correct settings.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nv">$hash</span> <span class="p">=</span> <span class="vm">@</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;DebugLog&#39;</span>          <span class="p">=</span><span class="s1">&#39;false&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;[settings]Hostname&#39;</span><span class="p">=</span><span class="s1">&#39;localhost&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="nb">Test-Ini</span> <span class="n">-Path</span> <span class="s2">&#34;C:\config.ini&#34;</span> <span class="n">-Values</span> <span class="nv">$hash</span>
</span></span></code></pre></div><h2 id="where-to-download">Where to download</h2>
<p>This module is available in the <a href="https://www.powershellgallery.com/packages/IniManager">PowerShell Gallery</a> and <a href="https://gallery.technet.microsoft.com/scriptcenter/IniManager-2eb8cafd">Microsoft Script Center</a>. If you would like to see more examples, report a bug or contribute with more features, you can visit <a href="https://github.com/JohnRoos/PowerShell">my GitHub repository</a>.</p>


            <p>- Written by John  
            
                
                
                on April 23, 2016</p>

            
                <div class="disqus-section">
                    <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "blog-roostech-se" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                </div>
            
        </div>

    </div>
    


            </div>
        </div>
    </body>
</html>
