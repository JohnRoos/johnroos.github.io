<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/css/syntax.css">
    <link rel="stylesheet" type="text/css" href="/css/style.css">
</head><body>
        <div class="container">
<input class="explorer-toggle" type="checkbox" id="explorer-toggle" checked>
<label class="explorer-toggle-label" for="explorer-toggle"><div class="explorer-toggle-label-clickablearea"></div></label>

<div class="explorer-toggle-label-selection"></div>

<div class="left-menu-button-bar"></div>

<diV class='left-menu'>
    
    <ul class="root">
        <li class="root"><span class="rotate-letter">></span><span class="menu-item"><a class="menu-item-site" href="http://blog.roostech.se/">blog.roostech.se (HUGOVSCODE)</a></span>
            <ul>  
                <li><span class="rotate-letter">></span><span class="menu-item">content</span>
                    <ul>
                        <li><span class="rotate-letter">></span><span class="menu-item">posts</span>
                            <ul>
                                
                                <li ><a href="/posts/deploy-azure-function-app-without-downtime/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Deploy Azure Function App without downtime.md</span></a></li>
                                
                                <li ><a href="/posts/moving-from-blogger-to-github-pages-with-hugo/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Moving from Blogger to GitHub Pages using Hugo.md</span></a></li>
                                
                                <li ><a href="/posts/pester-5-discovery-and-testcases/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Pester 5: Discovery and TestCases.md</span></a></li>
                                
                                <li ><a href="/posts/create-and-use-azure-table-storage-with-powershell/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Create and use Azure Table storage with PowerShell.md</span></a></li>
                                
                                <li ><a href="/posts/use-edit-command-to-discover-the-code-behind-built-in-cmdlets/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Use Edit-Command to discover the code behind built-in cmdlets.md</span></a></li>
                                
                                <li class="current"><a href="/posts/invoke-restmethod-with-anti-forgery-tokens-in-header-and-cookie/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Invoke-RestMethod with anti-forgery tokens in header and cookie.md</span></a></li>
                                
                                <li ><a href="/posts/introducing-the-inimanager-module/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Introducing the IniManager module.md</span></a></li>
                                
                                <li ><a href="/posts/use-powershell-jobs-to-ping-many-from-many-with-log/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Use PowerShell jobs to ping many from many with log.md</span></a></li>
                                
                                <li ><a href="/posts/powershell-logo-made-with-css3/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">PowerShell logo made with CSS3.md</span></a></li>
                                
                                <li ><a href="/posts/what-is-this-here-string-people-are-talking-about/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">What is this here-string people are talking about?.md</span></a></li>
                                
                                <li ><a href="/posts/dynamic-parameters-in-powershell-executes-before-you-know-it/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Dynamic parameters in PowerShell executes before you know it.md</span></a></li>
                                
                                <li ><a href="/posts/making-powershell-expressions-easier/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Making PowerShell expressions easier.md</span></a></li>
                                
                                <li ><a href="/posts/simple-select-from-database-with-powershell/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Simple select from database with PowerShell.md</span></a></li>
                                
                                <li ><a href="/posts/how-to-use-splatting-in-powershell/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">How to use splatting in PowerShell.md</span></a></li>
                                
                                <li ><a href="/posts/get-imdbmovie-using-invoke-webrequest/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Get-IMDBmovie using Invoke-WebRequest.md</span></a></li>
                                
                                <li ><a href="/posts/classes-in-powershell-5.0/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Classes in Powershell 5.0.md</span></a></li>
                                
                                <li ><a href="/posts/how-to-get-started-with-powershell/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">How to get started with Powershell.md</span></a></li>
                                
                                <li ><a href="/posts/powershell-script-find-hotfix-status/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Powershell script: Find hotfix status.md</span></a></li>
                                
                                <li ><a href="/posts/powershell-script-write-object-to-sql/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Powershell script: Write object to SQL.md</span></a></li>
                                
                                <li ><a href="/posts/get-type-alternative-for-null-values/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Get-Type alternative for $null values.md</span></a></li>
                                
                                <li ><a href="/posts/compress-files-to-zip-with-powershell/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Compress files to Zip with Powershell.md</span></a></li>
                                
                                <li ><a href="/posts/enable-real-time-jmx-monitoring-in-cognos/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Enable real time JMX monitoring in Cognos.md</span></a></li>
                                
                                <li ><a href="/posts/move-data-or-log-files-for-tempdb-in-sql-server/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Move data or log files for TempDB in SQL Server.md</span></a></li>
                                
                                <li ><a href="/posts/resources-for-remotefx-in-windows-server-2012/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Resources for RemoteFX in Windows Server 2012.md</span></a></li>
                                
                                <li ><a href="/posts/rdp-8.0-for-windows-7-sp1/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">RDP 8.0 for Windows 7 SP1.md</span></a></li>
                                
                                <li ><a href="/posts/improving-remotefx-performance-in-hyper-v/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Improving RemoteFX performance in Hyper-V.md</span></a></li>
                                
                                <li ><a href="/posts/configure-remotefx-in-hyper-v-running-windows-server-2012-with-low-end-gpu/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Configure RemoteFX in Hyper-V running Windows Server 2012 with low end GPU.md</span></a></li>
                                
                                <li ><a href="/posts/sqlps-and-its-limitations/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">SQLPS and its limitations.md</span></a></li>
                                
                                <li ><a href="/posts/script-deployment-of-ssis-packages-from-folder/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Script deployment of SSIS packages from folder.md</span></a></li>
                                
                                <li ><a href="/posts/dynamic-deploy-of-ssrs-reports-using-rs.exe/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Dynamic deploy of SSRS reports using rs.exe.md</span></a></li>
                                
                                <li ><a href="/posts/remove-headers-in-excel-exports-to-fix-column-alignment/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Remove headers in Excel exports to fix column alignment.md</span></a></li>
                                
                                <li ><a href="/posts/using-executionlog2-for-statistics-and-monitoring/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Using ExecutionLog2 for statistics and monitoring.md</span></a></li>
                                
                            </ul>
                        </li>
                        <li><span class="rotate-letter">></span><span class="menu-item">pages</span>
                            <ul>
                                
                                <li ><a href="/about/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">About me.md</span></a></li>
                                
                                <li ><a href="/gists/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Gists.md</span></a></li>
                                
                                <li ><a href="/parameter-validation/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Parameter Validation.md</span></a></li>
                                
                            </ul>
                        </li>
                    </ul>
                </li>
                <li>><span class="menu-item">data</span></li>
                <li>><span class="menu-item">layouts</span></li>
                <li>><span class="menu-item">resources</span></li>
                <li>><span class="menu-item">static</span></li>
                <li>><span class="menu-item">themes</span></li>
                <li>config.toml</li>
            </ul>
        </li>
    </ul>
  

    
</diV><div class='main'>
     
     
     
    
     
    
     
    
     
    
     
    
    
        
        <div class="main-tabs">
            <div class="main-tabs-scroll">
                <div class="main-tabs-table">
                    <div class ="main-tabs-row">
                        <div class="main-tab">
                            <span class="rotate-letter md-icon">&#10144;</span> <a href="/">Home.md</a> 
                        </div>
                    
                        <div class="main-tab current">
                            <span class="rotate-letter md-icon">&#10144;</span> <i>Invoke-RestMethod with anti-forgery tokens in header and cookie.md</i> 
                        </div>
                    
                    
                        <div class="main-tab">
                            <span class="rotate-letter md-icon">&#10144;</span> <a href="/posts/deploy-azure-function-app-without-downtime/">Deploy Azure Function App without downtime.md</a>
                        </div>
                    
                        <div class="main-tab">
                            <span class="rotate-letter md-icon">&#10144;</span> <a href="/posts/moving-from-blogger-to-github-pages-with-hugo/">Moving from Blogger to GitHub Pages using Hugo.md</a>
                        </div>
                    
                        <div class="main-tab">
                            <span class="rotate-letter md-icon">&#10144;</span> <a href="/posts/pester-5-discovery-and-testcases/">Pester 5: Discovery and TestCases.md</a>
                        </div>
                    
                        <div class="main-tab">
                            <span class="rotate-letter md-icon">&#10144;</span> <a href="/posts/create-and-use-azure-table-storage-with-powershell/">Create and use Azure Table storage with PowerShell.md</a>
                        </div>
                    
                        <div class="main-tab">
                            <span class="rotate-letter md-icon">&#10144;</span> <a href="/posts/use-edit-command-to-discover-the-code-behind-built-in-cmdlets/">Use Edit-Command to discover the code behind built-in cmdlets.md</a>
                        </div>
                    
                    </div>
                </div>
            </div>
        </div>
        <div class="main-path">
            <a class="path-link" href="http://blog.roostech.se/">blog.roostech.se</a> > content > posts &gt; Invoke-RestMethod with anti-forgery tokens in header and cookie.md
        </div>
        <div class="main-content-toggle">

            
            <input class="source-preview-split" type="checkbox" id="source-preview-split-toggle">
            <label class="source-preview-split-label" for="source-preview-split-toggle"></label>

            <input class="source-toggle" type="checkbox" id="source-toggle">
            <label class="source-toggle-label" for="source-toggle"></label>

            <div class="main-content">
                ---<br />
                <span class="md-frontmatter">title</span>: <span class="md-frontmatter-string">Invoke-RestMethod with anti-forgery tokens in header and cookie</span><br />
                <span class="md-frontmatter">date</span>: 2017-02-21 14:14:00 &#43;0200 &#43;0200<br />
                <span class="md-frontmatter">draft</span>: <span class="md-frontmatter">false</span><br />
                <span class="md-frontmatter">author</span>: <span class="md-frontmatter-string">John</span><br />
                ----
                <p>To help prevent cross-site scripting attacks some websites uses anti-forgery tokens. If you would like to talk to a REST API which uses this security measure you might run into problems if you are trying to use the PowerShell cmdlet Invoke-RestMethod. I have seen some people suggesting that Invoke-RestMethod does not have support for this, which is not true. It&rsquo;s just a little bit more complicated than expected.</p>
<p>What&rsquo;s needed is basically a custom header and a cookie. It’s the last part with the cookie which makes people think that Invoke-RestMethod does not work because it does not support cookies. It does. The header goes into the header parameter as expected, but the cookie need to go into a web session variable which is used for the websession parameter.</p>
<p>So let&rsquo;s get into the code. First we need the basics, like uri, content type and all that.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="no">[System.Uri]</span><span class="nv">$Uri</span> <span class="p">=</span> <span class="s2">&#34;http://pizzaserver.example.com/api/pizza/1&#34;</span>
<span class="nv">$ContentType</span> <span class="p">=</span> <span class="s2">&#34;application/json&#34;</span>
<span class="nv">$Method</span> <span class="p">=</span> <span class="s1">&#39;PUT&#39;</span>
<span class="nv">$Body</span> <span class="p">=</span> <span class="s1">&#39;{ &#34;id&#34; = 1, &#34;Name&#34; = &#34;Peperoni&#34; }&#39;</span>
</code></pre></div><p>So now we have a small body which we are going to use to update a record in the REST API using the PUT method.
Now the cookie. It’s a very simple .Net class which is kind of like a small hash table. Change the name and value into what is needed for your anti-forgery token.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$Cookie</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Net</span><span class="p">.</span><span class="n">Cookie</span>
<span class="nv">$Cookie</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="s2">&#34;My cookie name&#34;</span>
<span class="nv">$Cookie</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="s2">&#34;My cookie value&#34;</span>
<span class="nv">$Cookie</span><span class="p">.</span><span class="n">Domain</span> <span class="p">=</span> <span class="nv">$uri</span><span class="p">.</span><span class="n">DnsSafeHost</span>
</code></pre></div><p>Create the web session and add the cookie to it.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$WebSession</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">-TypeName</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">PowerShell</span><span class="p">.</span><span class="n">Commands</span><span class="p">.</span><span class="n">WebRequestSession</span>
<span class="nv">$WebSession</span><span class="p">.</span><span class="n">Cookies</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="nv">$Cookie</span><span class="p">)</span>
</code></pre></div><p>That’s actually everything you need for the cookie. Next is the header. Modify the name and value to match the other token.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$Headers</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="s1">&#39;My header name&#39;</span> <span class="p">=</span> <span class="s1">&#39;My header value&#39;</span>
<span class="p">}</span>
</code></pre></div><p>Now we are ready to run Invoke-RestMethod. I prefer to use splatting for the parameters.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$props</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="n">Uri</span>     <span class="p">=</span> <span class="nv">$uri</span><span class="p">.</span><span class="n">AbsoluteUri</span>
    <span class="n">Headers</span> <span class="p">=</span> <span class="nv">$Headers</span>
    <span class="n">ContentType</span> <span class="p">=</span> <span class="nv">$ContentType</span>
    <span class="n">Method</span> <span class="p">=</span> <span class="nv">$Method</span>
    <span class="n">WebSession</span> <span class="p">=</span> <span class="nv">$WebSession</span>
    <span class="n">Body</span> <span class="p">=</span> <span class="nv">$Body</span>
<span class="p">}</span>
</code></pre></div><p>Invoke-RestMethod @props
That’s it. Now we can talk to a secure REST API.</p>
<h2 id="full-script">Full script</h2>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="no">[System.Uri]</span><span class="nv">$Uri</span> <span class="p">=</span> <span class="s2">&#34;http://pizzaserver.example.com/api/pizza/1&#34;</span>
<span class="nv">$ContentType</span> <span class="p">=</span> <span class="s2">&#34;application/json&#34;</span>
<span class="nv">$Method</span> <span class="p">=</span> <span class="s1">&#39;PUT&#39;</span>
<span class="nv">$Body</span> <span class="p">=</span> <span class="s1">&#39;{ &#34;id&#34; = 1, &#34;Name&#34; = &#34;Peperoni&#34; }&#39;</span>
 
<span class="nv">$Cookie</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Net</span><span class="p">.</span><span class="n">Cookie</span>
<span class="nv">$Cookie</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="s2">&#34;My cookie name&#34;</span>
<span class="nv">$Cookie</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="s2">&#34;My cookie value&#34;</span>
<span class="nv">$Cookie</span><span class="p">.</span><span class="n">Domain</span> <span class="p">=</span> <span class="nv">$uri</span><span class="p">.</span><span class="n">DnsSafeHost</span>
 
<span class="nv">$WebSession</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">PowerShell</span><span class="p">.</span><span class="n">Commands</span><span class="p">.</span><span class="n">WebRequestSession</span>
<span class="nv">$WebSession</span><span class="p">.</span><span class="n">Cookies</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="nv">$Cookie</span><span class="p">)</span>
 
<span class="nv">$Headers</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="s1">&#39;My header name&#39;</span> <span class="p">=</span> <span class="s1">&#39;My header value&#39;</span>
<span class="p">}</span>
 
<span class="nv">$props</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="n">Uri</span>         <span class="p">=</span> <span class="nv">$uri</span><span class="p">.</span><span class="n">AbsoluteUri</span>
    <span class="n">Headers</span>     <span class="p">=</span> <span class="nv">$Headers</span>
    <span class="n">ContentType</span> <span class="p">=</span> <span class="nv">$ContentType</span>
    <span class="n">Method</span>      <span class="p">=</span> <span class="nv">$Method</span>
    <span class="n">WebSession</span>  <span class="p">=</span> <span class="nv">$WebSession</span>
    <span class="n">Body</span>        <span class="p">=</span> <span class="nv">$Body</span>
<span class="p">}</span>
 
<span class="nb">Invoke-RestMethod</span> <span class="nv">@props</span>
</code></pre></div>
            </div>

            
            <div class="main-content-preview">
                <h1>Invoke-RestMethod with anti-forgery tokens in header and cookie</h1>
                <p>To help prevent cross-site scripting attacks some websites uses anti-forgery tokens. If you would like to talk to a REST API which uses this security measure you might run into problems if you are trying to use the PowerShell cmdlet Invoke-RestMethod. I have seen some people suggesting that Invoke-RestMethod does not have support for this, which is not true. It&rsquo;s just a little bit more complicated than expected.</p>
<p>What&rsquo;s needed is basically a custom header and a cookie. It’s the last part with the cookie which makes people think that Invoke-RestMethod does not work because it does not support cookies. It does. The header goes into the header parameter as expected, but the cookie need to go into a web session variable which is used for the websession parameter.</p>
<p>So let&rsquo;s get into the code. First we need the basics, like uri, content type and all that.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="no">[System.Uri]</span><span class="nv">$Uri</span> <span class="p">=</span> <span class="s2">&#34;http://pizzaserver.example.com/api/pizza/1&#34;</span>
<span class="nv">$ContentType</span> <span class="p">=</span> <span class="s2">&#34;application/json&#34;</span>
<span class="nv">$Method</span> <span class="p">=</span> <span class="s1">&#39;PUT&#39;</span>
<span class="nv">$Body</span> <span class="p">=</span> <span class="s1">&#39;{ &#34;id&#34; = 1, &#34;Name&#34; = &#34;Peperoni&#34; }&#39;</span>
</code></pre></div><p>So now we have a small body which we are going to use to update a record in the REST API using the PUT method.
Now the cookie. It’s a very simple .Net class which is kind of like a small hash table. Change the name and value into what is needed for your anti-forgery token.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$Cookie</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Net</span><span class="p">.</span><span class="n">Cookie</span>
<span class="nv">$Cookie</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="s2">&#34;My cookie name&#34;</span>
<span class="nv">$Cookie</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="s2">&#34;My cookie value&#34;</span>
<span class="nv">$Cookie</span><span class="p">.</span><span class="n">Domain</span> <span class="p">=</span> <span class="nv">$uri</span><span class="p">.</span><span class="n">DnsSafeHost</span>
</code></pre></div><p>Create the web session and add the cookie to it.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$WebSession</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">-TypeName</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">PowerShell</span><span class="p">.</span><span class="n">Commands</span><span class="p">.</span><span class="n">WebRequestSession</span>
<span class="nv">$WebSession</span><span class="p">.</span><span class="n">Cookies</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="nv">$Cookie</span><span class="p">)</span>
</code></pre></div><p>That’s actually everything you need for the cookie. Next is the header. Modify the name and value to match the other token.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$Headers</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="s1">&#39;My header name&#39;</span> <span class="p">=</span> <span class="s1">&#39;My header value&#39;</span>
<span class="p">}</span>
</code></pre></div><p>Now we are ready to run Invoke-RestMethod. I prefer to use splatting for the parameters.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$props</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="n">Uri</span>     <span class="p">=</span> <span class="nv">$uri</span><span class="p">.</span><span class="n">AbsoluteUri</span>
    <span class="n">Headers</span> <span class="p">=</span> <span class="nv">$Headers</span>
    <span class="n">ContentType</span> <span class="p">=</span> <span class="nv">$ContentType</span>
    <span class="n">Method</span> <span class="p">=</span> <span class="nv">$Method</span>
    <span class="n">WebSession</span> <span class="p">=</span> <span class="nv">$WebSession</span>
    <span class="n">Body</span> <span class="p">=</span> <span class="nv">$Body</span>
<span class="p">}</span>
</code></pre></div><p>Invoke-RestMethod @props
That’s it. Now we can talk to a secure REST API.</p>
<h2 id="full-script">Full script</h2>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="no">[System.Uri]</span><span class="nv">$Uri</span> <span class="p">=</span> <span class="s2">&#34;http://pizzaserver.example.com/api/pizza/1&#34;</span>
<span class="nv">$ContentType</span> <span class="p">=</span> <span class="s2">&#34;application/json&#34;</span>
<span class="nv">$Method</span> <span class="p">=</span> <span class="s1">&#39;PUT&#39;</span>
<span class="nv">$Body</span> <span class="p">=</span> <span class="s1">&#39;{ &#34;id&#34; = 1, &#34;Name&#34; = &#34;Peperoni&#34; }&#39;</span>
 
<span class="nv">$Cookie</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Net</span><span class="p">.</span><span class="n">Cookie</span>
<span class="nv">$Cookie</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="s2">&#34;My cookie name&#34;</span>
<span class="nv">$Cookie</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="s2">&#34;My cookie value&#34;</span>
<span class="nv">$Cookie</span><span class="p">.</span><span class="n">Domain</span> <span class="p">=</span> <span class="nv">$uri</span><span class="p">.</span><span class="n">DnsSafeHost</span>
 
<span class="nv">$WebSession</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">PowerShell</span><span class="p">.</span><span class="n">Commands</span><span class="p">.</span><span class="n">WebRequestSession</span>
<span class="nv">$WebSession</span><span class="p">.</span><span class="n">Cookies</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="nv">$Cookie</span><span class="p">)</span>
 
<span class="nv">$Headers</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="s1">&#39;My header name&#39;</span> <span class="p">=</span> <span class="s1">&#39;My header value&#39;</span>
<span class="p">}</span>
 
<span class="nv">$props</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="n">Uri</span>         <span class="p">=</span> <span class="nv">$uri</span><span class="p">.</span><span class="n">AbsoluteUri</span>
    <span class="n">Headers</span>     <span class="p">=</span> <span class="nv">$Headers</span>
    <span class="n">ContentType</span> <span class="p">=</span> <span class="nv">$ContentType</span>
    <span class="n">Method</span>      <span class="p">=</span> <span class="nv">$Method</span>
    <span class="n">WebSession</span>  <span class="p">=</span> <span class="nv">$WebSession</span>
    <span class="n">Body</span>        <span class="p">=</span> <span class="nv">$Body</span>
<span class="p">}</span>
 
<span class="nb">Invoke-RestMethod</span> <span class="nv">@props</span>
</code></pre></div>
            </div>

       </div>
    


            </div>
        </div>
    </body>
</html>
