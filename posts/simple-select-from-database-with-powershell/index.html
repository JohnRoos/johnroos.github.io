 
 

 

 

 

 

 


<!DOCTYPE html>
<html lang="en">




    



<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.86, maximum-scale=5.0, minimum-scale=0.86">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/css/syntax.css">
    <link rel="stylesheet" type="text/css" href="/css/style.css">

    <meta name='twitter:card'        content='summary' />
    <meta name='twitter:site'        content='@johnmroos'/>
    <meta name='twitter:creator'     content='@johnmroos'/>
    <meta name='twitter:title'       content='Simple select from database with PowerShell' />
    <meta name='twitter:description' content='There are a few ways of getting data from SQL Server in PowerShell. This is one way of doing it which is quite simple and does not require the SQL Server module. The sample below shows how to get started. If you are planning on creating a script for serious use you need to add error handling and investigate a bit more what each line actually does so that you are in full control.' />
    
    <meta name='twitter:domain'      content='https://blog.roostech.se/'/>
    

    <title>Simple select from database with PowerShell</title>
    <meta name="description" content="There are a few ways of getting data from SQL Server in PowerShell. This is one way of doing it which is quite simple and does not require the SQL Server module. The sample below shows how to get started. If you are planning on creating a script for serious use you need to add error handling and investigate a bit more what each line actually does so that you are in full control."/>
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9F2VG64X4H"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-9F2VG64X4H', { 'anonymize_ip': false });
}
</script>

</head><body>
        <div class="container">
<input class="explorer-toggle" type="checkbox" id="explorer-toggle">
<label class="explorer-toggle-label" for="explorer-toggle"><div class="explorer-toggle-label-clickablearea"></div></label>

<div class="explorer-toggle-label-selection"></div>

<div class="left-menu-button-bar"></div>

<diV class='left-menu'>
    
    <ul class="root">
        <li class="root"><div class="menu-item folder open"><a class="menu-item-site" href="https://blog.roostech.se/">blog.roostech.se (HUGOVSCODE)</a></div>
            <ul>  
                <li><span class="menu-item folder open">content</span>
                    <ul>
                        <li><span class="menu-item folder open">posts</span>
                            <ul>
                                
                                <li ><a href="/posts/get-function-configuration-from-deployed-function-app/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Get function configuration from deployed Function App.md</span></a></li>
                                
                                <li ><a href="/posts/deploy-azure-function-app-without-downtime/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Deploy Azure Function App without downtime.md</span></a></li>
                                
                                <li ><a href="/posts/moving-from-blogger-to-github-pages-with-hugo/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Moving from Blogger to GitHub Pages using Hugo.md</span></a></li>
                                
                                <li ><a href="/posts/pester-5-discovery-and-testcases/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Pester 5: Discovery and TestCases.md</span></a></li>
                                
                                <li ><a href="/posts/create-and-use-azure-table-storage-with-powershell/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Create and use Azure Table storage with PowerShell.md</span></a></li>
                                
                                <li ><a href="/posts/use-edit-command-to-discover-the-code-behind-built-in-cmdlets/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Use Edit-Command to discover the code behind built-in cmdlets.md</span></a></li>
                                
                                <li ><a href="/posts/invoke-restmethod-with-anti-forgery-tokens-in-header-and-cookie/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Invoke-RestMethod with anti-forgery tokens in header and cookie.md</span></a></li>
                                
                                <li ><a href="/posts/introducing-the-inimanager-module/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Introducing the IniManager module.md</span></a></li>
                                
                                <li ><a href="/posts/use-powershell-jobs-to-ping-many-from-many-with-log/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Use PowerShell jobs to ping many from many with log.md</span></a></li>
                                
                                <li ><a href="/posts/powershell-logo-made-with-css3/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">PowerShell logo made with CSS3.md</span></a></li>
                                
                                <li ><a href="/posts/what-is-this-here-string-people-are-talking-about/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">What is this here-string people are talking about?.md</span></a></li>
                                
                                <li ><a href="/posts/dynamic-parameters-in-powershell-executes-before-you-know-it/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Dynamic parameters in PowerShell executes before you know it.md</span></a></li>
                                
                                <li ><a href="/posts/making-powershell-expressions-easier/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Making PowerShell expressions easier.md</span></a></li>
                                
                                <li class="current"><a href="/posts/simple-select-from-database-with-powershell/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Simple select from database with PowerShell.md</span></a></li>
                                
                                <li ><a href="/posts/how-to-use-splatting-in-powershell/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">How to use splatting in PowerShell.md</span></a></li>
                                
                                <li ><a href="/posts/get-imdbmovie-using-invoke-webrequest/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Get-IMDBmovie using Invoke-WebRequest.md</span></a></li>
                                
                                <li ><a href="/posts/classes-in-powershell-5.0/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Classes in Powershell 5.0.md</span></a></li>
                                
                                <li ><a href="/posts/how-to-get-started-with-powershell/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">How to get started with Powershell.md</span></a></li>
                                
                                <li ><a href="/posts/powershell-script-find-hotfix-status/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Powershell script: Find hotfix status.md</span></a></li>
                                
                                <li ><a href="/posts/powershell-script-write-object-to-sql/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Powershell script: Write object to SQL.md</span></a></li>
                                
                                <li ><a href="/posts/get-type-alternative-for-null-values/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Get-Type alternative for $null values.md</span></a></li>
                                
                                <li ><a href="/posts/compress-files-to-zip-with-powershell/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Compress files to Zip with Powershell.md</span></a></li>
                                
                                <li ><a href="/posts/enable-real-time-jmx-monitoring-in-cognos/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Enable real time JMX monitoring in Cognos.md</span></a></li>
                                
                                <li ><a href="/posts/move-data-or-log-files-for-tempdb-in-sql-server/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Move data or log files for TempDB in SQL Server.md</span></a></li>
                                
                                <li ><a href="/posts/resources-for-remotefx-in-windows-server-2012/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Resources for RemoteFX in Windows Server 2012.md</span></a></li>
                                
                                <li ><a href="/posts/rdp-8.0-for-windows-7-sp1/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">RDP 8.0 for Windows 7 SP1.md</span></a></li>
                                
                                <li ><a href="/posts/improving-remotefx-performance-in-hyper-v/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Improving RemoteFX performance in Hyper-V.md</span></a></li>
                                
                                <li ><a href="/posts/configure-remotefx-in-hyper-v-running-windows-server-2012-with-low-end-gpu/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Configure RemoteFX in Hyper-V running Windows Server 2012 with low end GPU.md</span></a></li>
                                
                                <li ><a href="/posts/sqlps-and-its-limitations/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">SQLPS and its limitations.md</span></a></li>
                                
                                <li ><a href="/posts/script-deployment-of-ssis-packages-from-folder/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Script deployment of SSIS packages from folder.md</span></a></li>
                                
                                <li ><a href="/posts/dynamic-deploy-of-ssrs-reports-using-rs.exe/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Dynamic deploy of SSRS reports using rs.exe.md</span></a></li>
                                
                                <li ><a href="/posts/remove-headers-in-excel-exports-to-fix-column-alignment/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Remove headers in Excel exports to fix column alignment.md</span></a></li>
                                
                                <li ><a href="/posts/using-executionlog2-for-statistics-and-monitoring/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Using ExecutionLog2 for statistics and monitoring.md</span></a></li>
                                
                            </ul>
                        </li>
                        <li><span class="menu-item folder open">pages</span>
                            <ul>
                                
                                <li ><a href="/about/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">About me.md</span></a></li>
                                
                                <li ><a href="/chroma/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Chroma.md</span></a></li>
                                
                            </ul>
                        </li>
                    </ul>
                </li>
                <li><span class="menu-item folder">data</span></li>
                <li><span class="menu-item folder">layouts</span></li>
                <li><span class="menu-item folder">resources</span></li>
                <li><span class="menu-item folder">static</span></li>
                <li><span class="menu-item folder open">themes</span>
                    <ul>
                        <li><span class="menu-item folder open">hugovscode</span>
                            <ul>
                                <li><a href="https://github.com/JohnRoos/HugoVSCode/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">.git</span></a></li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li>config.toml</li>
            </ul>
        </li>
    </ul>
  

    
</diV>
                <div class ="main-tabs">
                    <div class="main-tab">
                        <span class="rotate-letter md-icon">&#10144;</span> <a href="/">Home.md</a> 
                    </div>
                
                    <div class="main-tab current">
                        <span class="rotate-letter md-icon">&#10144;</span> <i>Simple select from database with PowerShell.md</i> 
                    </div>
                
                
                    <div class="main-tab">
                        <span class="rotate-letter md-icon">&#10144;</span> <a href="/posts/get-function-configuration-from-deployed-function-app/">Get function configuration from deployed Function App.md</a>
                    </div>
                
                    <div class="main-tab">
                        <span class="rotate-letter md-icon">&#10144;</span> <a href="/posts/deploy-azure-function-app-without-downtime/">Deploy Azure Function App without downtime.md</a>
                    </div>
                
                    <div class="main-tab">
                        <span class="rotate-letter md-icon">&#10144;</span> <a href="/posts/moving-from-blogger-to-github-pages-with-hugo/">Moving from Blogger to GitHub Pages using Hugo.md</a>
                    </div>
                
                    <div class="main-tab">
                        <span class="rotate-letter md-icon">&#10144;</span> <a href="/posts/pester-5-discovery-and-testcases/">Pester 5: Discovery and TestCases.md</a>
                    </div>
                
                    <div class="main-tab">
                        <span class="rotate-letter md-icon">&#10144;</span> <a href="/posts/create-and-use-azure-table-storage-with-powershell/">Create and use Azure Table storage with PowerShell.md</a>
                    </div>
                
                </div>
            
            
            <div class='main'>
    <div class="main-path">
        <span><a class="path-link" href="https://blog.roostech.se/">blog.roostech.se</a></span><span class="folder">content</span><span class="folder">posts</span><span class="folder">Simple select from database with PowerShell.md</span>
        
                
                
                <span class="postdate-container">&nbsp;(<time class="postdate" datetime="2015-07-14">July 14, 2015</time>)</span>
            
    </div>
    
    <div class="main-content-toggle">

        
        <input class="source-preview-split" type="checkbox" id="source-preview-split-toggle">
        <label class="source-preview-split-label" for="source-preview-split-toggle"></label>

        <input class="source-toggle" type="checkbox" id="source-toggle">
        <label class="source-toggle-label" for="source-toggle"></label>

        <div class="main-content">
            ---<br />
            <span class="md-frontmatter">title</span>: <span class="md-frontmatter-string">Simple select from database with PowerShell</span><br />
            <span class="md-frontmatter">date</span>: 2015-07-14 14:14:00 &#43;0200 CEST<br />
            <span class="md-frontmatter">draft</span>: <span class="md-frontmatter">false</span><br />
            <span class="md-frontmatter">author</span>: <span class="md-frontmatter-string">John</span><br />
            ----
            <p>There are a few ways of getting data from SQL Server in PowerShell. This is one way of doing it which is quite simple and does not require the SQL Server module. The sample below shows how to get started. If you are planning on creating a script for serious use you need to add error handling and investigate a bit more what each line actually does so that you are in full control. Note that this is only for select statements. Insert, update and delete works slightly different, but I might get to that in the future.</p>
<p>To get started I have added three variables which you can use to adapt to your environment.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nv">$server</span>   <span class="p">=</span> <span class="s1">&#39;localhost\sqlexpress&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$database</span> <span class="p">=</span> <span class="s1">&#39;myDB&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$query</span>    <span class="p">=</span> <span class="s1">&#39;select * from myTable&#39;</span>
</span></span></code></pre></div><p>After that we need to set up the objects needed to communicate with the database.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nv">$connection</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">-TypeName</span> <span class="n">System</span><span class="p">.</span><span class="py">Data</span><span class="p">.</span><span class="py">SqlClient</span><span class="p">.</span><span class="py">SqlConnection</span>
</span></span><span class="line"><span class="cl"><span class="nv">$adapter</span>    <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">-TypeName</span> <span class="n">System</span><span class="p">.</span><span class="py">Data</span><span class="p">.</span><span class="py">SqlClient</span><span class="p">.</span><span class="py">SqlDataAdapter</span> <span class="nv">$command</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dataset</span>    <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">-TypeName</span> <span class="n">System</span><span class="p">.</span><span class="py">Data</span><span class="p">.</span><span class="py">DataSet</span>
</span></span></code></pre></div><p>Next is the connection string, which should work with most installations of SQL Server. After the connection string is created we open the connection to the server.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nv">$connection</span><span class="p">.</span><span class="py">ConnectionString</span> <span class="p">=</span> <span class="s2">&#34;Server=</span><span class="nv">$server</span><span class="s2">;Database=</span><span class="nv">$database</span><span class="s2">;Trusted_Connection=True;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$connection</span><span class="p">.</span><span class="py">Open</span><span class="p">()</span>
</span></span></code></pre></div><p>The query need to be a proper command object, so lets do that.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nv">$command</span> <span class="p">=</span> <span class="nv">$connection</span><span class="p">.</span><span class="py">CreateCommand</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nv">$command</span><span class="p">.</span><span class="py">CommandText</span> <span class="p">=</span> <span class="nv">$query</span>
</span></span></code></pre></div><p>Fill the dataset with the result from the database. Lets also count the rows while we are at it.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nv">$rowCount</span> <span class="p">=</span> <span class="nv">$adapter</span><span class="p">.</span><span class="py">Fill</span><span class="p">(</span><span class="nv">$dataset</span><span class="p">)</span>
</span></span></code></pre></div><p>Now we dont need the connection to the database anymore, so lets close it.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nv">$connection</span><span class="p">.</span><span class="py">Close</span><span class="p">()</span>
</span></span></code></pre></div><p>Now we are done! Return the rows.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nv">$dataset</span><span class="p">.</span><span class="py">Tables</span><span class="p">.</span><span class="py">rows</span>
</span></span></code></pre></div><p>Optionally you can also print the row count to the screen.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Write-Host</span> <span class="s2">&#34;Rows returned: </span><span class="nv">$rowCount</span><span class="s2">&#34;</span>
</span></span></code></pre></div><p>That&rsquo;s how simple it can be to use a select statement with SQL Server.</p>
<h2 id="full-script">Full script</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c"># Variables for server, database and query</span>
</span></span><span class="line"><span class="cl"><span class="nv">$server</span>   <span class="p">=</span> <span class="s1">&#39;localhost\sqlexpress&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$database</span> <span class="p">=</span> <span class="s1">&#39;test&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$query</span>    <span class="p">=</span> <span class="s1">&#39;select top 10 * from fjutt&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Set up the objects needed</span>
</span></span><span class="line"><span class="cl"><span class="nv">$connection</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">-TypeName</span> <span class="n">System</span><span class="p">.</span><span class="py">Data</span><span class="p">.</span><span class="py">SqlClient</span><span class="p">.</span><span class="py">SqlConnection</span>
</span></span><span class="line"><span class="cl"><span class="nv">$adapter</span>    <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">-TypeName</span> <span class="n">System</span><span class="p">.</span><span class="py">Data</span><span class="p">.</span><span class="py">SqlClient</span><span class="p">.</span><span class="py">SqlDataAdapter</span> <span class="nv">$command</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dataset</span>    <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">-TypeName</span> <span class="n">System</span><span class="p">.</span><span class="py">Data</span><span class="p">.</span><span class="py">DataSet</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Set the connection string (using single sign on) and open the connection</span>
</span></span><span class="line"><span class="cl"><span class="nv">$connection</span><span class="p">.</span><span class="py">ConnectionString</span> <span class="p">=</span> <span class="s2">&#34;Server=</span><span class="nv">$server</span><span class="s2">;Database=</span><span class="nv">$database</span><span class="s2">;Trusted_Connection=True;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$connection</span><span class="p">.</span><span class="py">Open</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Create a command object and assign the query</span>
</span></span><span class="line"><span class="cl"><span class="nv">$command</span> <span class="p">=</span> <span class="nv">$connection</span><span class="p">.</span><span class="py">CreateCommand</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nv">$command</span><span class="p">.</span><span class="py">CommandText</span> <span class="p">=</span> <span class="nv">$query</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Fill the dataset and count the rows returned at the same time</span>
</span></span><span class="line"><span class="cl"><span class="nv">$rowCount</span> <span class="p">=</span> <span class="nv">$adapter</span><span class="p">.</span><span class="py">Fill</span><span class="p">(</span><span class="nv">$dataset</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Since the dataset is populated we can now close the connection</span>
</span></span><span class="line"><span class="cl"><span class="nv">$connection</span><span class="p">.</span><span class="py">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Return the results</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dataset</span><span class="p">.</span><span class="py">Tables</span><span class="p">.</span><span class="py">rows</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Print amount of rows to screen (optional)</span>
</span></span><span class="line"><span class="cl"><span class="nb">Write-Host</span> <span class="s2">&#34;Rows returned: </span><span class="nv">$rowCount</span><span class="s2">&#34;</span>
</span></span></code></pre></div>
        </div>

        
        <div class="main-content-preview">
            <h1>Simple select from database with PowerShell</h1>
            
            <p>There are a few ways of getting data from SQL Server in PowerShell. This is one way of doing it which is quite simple and does not require the SQL Server module. The sample below shows how to get started. If you are planning on creating a script for serious use you need to add error handling and investigate a bit more what each line actually does so that you are in full control. Note that this is only for select statements. Insert, update and delete works slightly different, but I might get to that in the future.</p>
<p>To get started I have added three variables which you can use to adapt to your environment.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nv">$server</span>   <span class="p">=</span> <span class="s1">&#39;localhost\sqlexpress&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$database</span> <span class="p">=</span> <span class="s1">&#39;myDB&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$query</span>    <span class="p">=</span> <span class="s1">&#39;select * from myTable&#39;</span>
</span></span></code></pre></div><p>After that we need to set up the objects needed to communicate with the database.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nv">$connection</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">-TypeName</span> <span class="n">System</span><span class="p">.</span><span class="py">Data</span><span class="p">.</span><span class="py">SqlClient</span><span class="p">.</span><span class="py">SqlConnection</span>
</span></span><span class="line"><span class="cl"><span class="nv">$adapter</span>    <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">-TypeName</span> <span class="n">System</span><span class="p">.</span><span class="py">Data</span><span class="p">.</span><span class="py">SqlClient</span><span class="p">.</span><span class="py">SqlDataAdapter</span> <span class="nv">$command</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dataset</span>    <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">-TypeName</span> <span class="n">System</span><span class="p">.</span><span class="py">Data</span><span class="p">.</span><span class="py">DataSet</span>
</span></span></code></pre></div><p>Next is the connection string, which should work with most installations of SQL Server. After the connection string is created we open the connection to the server.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nv">$connection</span><span class="p">.</span><span class="py">ConnectionString</span> <span class="p">=</span> <span class="s2">&#34;Server=</span><span class="nv">$server</span><span class="s2">;Database=</span><span class="nv">$database</span><span class="s2">;Trusted_Connection=True;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$connection</span><span class="p">.</span><span class="py">Open</span><span class="p">()</span>
</span></span></code></pre></div><p>The query need to be a proper command object, so lets do that.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nv">$command</span> <span class="p">=</span> <span class="nv">$connection</span><span class="p">.</span><span class="py">CreateCommand</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nv">$command</span><span class="p">.</span><span class="py">CommandText</span> <span class="p">=</span> <span class="nv">$query</span>
</span></span></code></pre></div><p>Fill the dataset with the result from the database. Lets also count the rows while we are at it.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nv">$rowCount</span> <span class="p">=</span> <span class="nv">$adapter</span><span class="p">.</span><span class="py">Fill</span><span class="p">(</span><span class="nv">$dataset</span><span class="p">)</span>
</span></span></code></pre></div><p>Now we dont need the connection to the database anymore, so lets close it.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nv">$connection</span><span class="p">.</span><span class="py">Close</span><span class="p">()</span>
</span></span></code></pre></div><p>Now we are done! Return the rows.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nv">$dataset</span><span class="p">.</span><span class="py">Tables</span><span class="p">.</span><span class="py">rows</span>
</span></span></code></pre></div><p>Optionally you can also print the row count to the screen.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="nb">Write-Host</span> <span class="s2">&#34;Rows returned: </span><span class="nv">$rowCount</span><span class="s2">&#34;</span>
</span></span></code></pre></div><p>That&rsquo;s how simple it can be to use a select statement with SQL Server.</p>
<h2 id="full-script">Full script</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c"># Variables for server, database and query</span>
</span></span><span class="line"><span class="cl"><span class="nv">$server</span>   <span class="p">=</span> <span class="s1">&#39;localhost\sqlexpress&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$database</span> <span class="p">=</span> <span class="s1">&#39;test&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$query</span>    <span class="p">=</span> <span class="s1">&#39;select top 10 * from fjutt&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Set up the objects needed</span>
</span></span><span class="line"><span class="cl"><span class="nv">$connection</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">-TypeName</span> <span class="n">System</span><span class="p">.</span><span class="py">Data</span><span class="p">.</span><span class="py">SqlClient</span><span class="p">.</span><span class="py">SqlConnection</span>
</span></span><span class="line"><span class="cl"><span class="nv">$adapter</span>    <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">-TypeName</span> <span class="n">System</span><span class="p">.</span><span class="py">Data</span><span class="p">.</span><span class="py">SqlClient</span><span class="p">.</span><span class="py">SqlDataAdapter</span> <span class="nv">$command</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dataset</span>    <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">-TypeName</span> <span class="n">System</span><span class="p">.</span><span class="py">Data</span><span class="p">.</span><span class="py">DataSet</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Set the connection string (using single sign on) and open the connection</span>
</span></span><span class="line"><span class="cl"><span class="nv">$connection</span><span class="p">.</span><span class="py">ConnectionString</span> <span class="p">=</span> <span class="s2">&#34;Server=</span><span class="nv">$server</span><span class="s2">;Database=</span><span class="nv">$database</span><span class="s2">;Trusted_Connection=True;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$connection</span><span class="p">.</span><span class="py">Open</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Create a command object and assign the query</span>
</span></span><span class="line"><span class="cl"><span class="nv">$command</span> <span class="p">=</span> <span class="nv">$connection</span><span class="p">.</span><span class="py">CreateCommand</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nv">$command</span><span class="p">.</span><span class="py">CommandText</span> <span class="p">=</span> <span class="nv">$query</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Fill the dataset and count the rows returned at the same time</span>
</span></span><span class="line"><span class="cl"><span class="nv">$rowCount</span> <span class="p">=</span> <span class="nv">$adapter</span><span class="p">.</span><span class="py">Fill</span><span class="p">(</span><span class="nv">$dataset</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Since the dataset is populated we can now close the connection</span>
</span></span><span class="line"><span class="cl"><span class="nv">$connection</span><span class="p">.</span><span class="py">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Return the results</span>
</span></span><span class="line"><span class="cl"><span class="nv">$dataset</span><span class="p">.</span><span class="py">Tables</span><span class="p">.</span><span class="py">rows</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Print amount of rows to screen (optional)</span>
</span></span><span class="line"><span class="cl"><span class="nb">Write-Host</span> <span class="s2">&#34;Rows returned: </span><span class="nv">$rowCount</span><span class="s2">&#34;</span>
</span></span></code></pre></div>

            <p>- Written by John  
            
                
                
                on July 14, 2015</p>

            
                <div class="disqus-section">
                    
                </div>
            
        </div>

    </div>
    


            </div>
        </div>
    </body>
</html>
