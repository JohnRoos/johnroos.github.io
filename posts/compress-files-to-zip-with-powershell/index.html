<!DOCTYPE html>
<html lang="en">




    



<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.86, maximum-scale=5.0, minimum-scale=0.86">
    <link rel="stylesheet" type="text/css" href="/css/syntax.css">
    <link rel="stylesheet" type="text/css" href="/css/style.css">

    <meta name='twitter:card'        content='summary' />
    <meta name='twitter:site'        content='@johnmroos'/>
    <meta name='twitter:creator'     content='@johnmroos'/>
    <meta name='twitter:title'       content='Compress files to Zip with Powershell' />
    <meta name='twitter:description' content='I have seen a lot of people writing PowerShell scripts to compress files or folders by using external file compression programs. Often Winrar, 7-Zip or something similar is used since PowerShell does not have any built in cmdlet to do this (not until version 5 at least).
There is however a pretty simple way of doing this with only PowerShell. This is how.
# First we add the .Net framework class needed for file compression.' />
    
    <meta name='twitter:domain'      content='http://blog.roostech.se/'/>
    

    <title>Compress files to Zip with Powershell</title>
    <meta name="description" content="I have seen a lot of people writing PowerShell scripts to compress files or folders by using external file compression programs. Often Winrar, 7-Zip or something similar is used since PowerShell does not have any built in cmdlet to do this (not until version 5 at least).
There is however a pretty simple way of doing this with only PowerShell. This is how.
# First we add the .Net framework class needed for file compression."/>
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-35019756-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

</head><body>
        <div class="container">
<input class="explorer-toggle" type="checkbox" id="explorer-toggle" checked>
<label class="explorer-toggle-label" for="explorer-toggle"><div class="explorer-toggle-label-clickablearea"></div></label>

<div class="explorer-toggle-label-selection"></div>

<div class="left-menu-button-bar"></div>

<diV class='left-menu'>
    
    <ul class="root">
        <li class="root"><span class="rotate-letter">></span><span class="menu-item"><a class="menu-item-site" href="http://blog.roostech.se/">blog.roostech.se (HUGOVSCODE)</a></span>
            <ul>  
                <li><span class="rotate-letter">></span><span class="menu-item">content</span>
                    <ul>
                        <li><span class="rotate-letter">></span><span class="menu-item">posts</span>
                            <ul>
                                
                                <li ><a href="/posts/deploy-azure-function-app-without-downtime/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Deploy Azure Function App without downtime.md</span></a></li>
                                
                                <li ><a href="/posts/moving-from-blogger-to-github-pages-with-hugo/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Moving from Blogger to GitHub Pages using Hugo.md</span></a></li>
                                
                                <li ><a href="/posts/pester-5-discovery-and-testcases/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Pester 5: Discovery and TestCases.md</span></a></li>
                                
                                <li ><a href="/posts/create-and-use-azure-table-storage-with-powershell/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Create and use Azure Table storage with PowerShell.md</span></a></li>
                                
                                <li ><a href="/posts/use-edit-command-to-discover-the-code-behind-built-in-cmdlets/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Use Edit-Command to discover the code behind built-in cmdlets.md</span></a></li>
                                
                                <li ><a href="/posts/invoke-restmethod-with-anti-forgery-tokens-in-header-and-cookie/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Invoke-RestMethod with anti-forgery tokens in header and cookie.md</span></a></li>
                                
                                <li ><a href="/posts/introducing-the-inimanager-module/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Introducing the IniManager module.md</span></a></li>
                                
                                <li ><a href="/posts/use-powershell-jobs-to-ping-many-from-many-with-log/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Use PowerShell jobs to ping many from many with log.md</span></a></li>
                                
                                <li ><a href="/posts/powershell-logo-made-with-css3/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">PowerShell logo made with CSS3.md</span></a></li>
                                
                                <li ><a href="/posts/what-is-this-here-string-people-are-talking-about/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">What is this here-string people are talking about?.md</span></a></li>
                                
                                <li ><a href="/posts/dynamic-parameters-in-powershell-executes-before-you-know-it/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Dynamic parameters in PowerShell executes before you know it.md</span></a></li>
                                
                                <li ><a href="/posts/making-powershell-expressions-easier/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Making PowerShell expressions easier.md</span></a></li>
                                
                                <li ><a href="/posts/simple-select-from-database-with-powershell/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Simple select from database with PowerShell.md</span></a></li>
                                
                                <li ><a href="/posts/how-to-use-splatting-in-powershell/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">How to use splatting in PowerShell.md</span></a></li>
                                
                                <li ><a href="/posts/get-imdbmovie-using-invoke-webrequest/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Get-IMDBmovie using Invoke-WebRequest.md</span></a></li>
                                
                                <li ><a href="/posts/classes-in-powershell-5.0/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Classes in Powershell 5.0.md</span></a></li>
                                
                                <li ><a href="/posts/how-to-get-started-with-powershell/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">How to get started with Powershell.md</span></a></li>
                                
                                <li ><a href="/posts/powershell-script-find-hotfix-status/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Powershell script: Find hotfix status.md</span></a></li>
                                
                                <li ><a href="/posts/powershell-script-write-object-to-sql/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Powershell script: Write object to SQL.md</span></a></li>
                                
                                <li ><a href="/posts/get-type-alternative-for-null-values/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Get-Type alternative for $null values.md</span></a></li>
                                
                                <li class="current"><a href="/posts/compress-files-to-zip-with-powershell/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Compress files to Zip with Powershell.md</span></a></li>
                                
                                <li ><a href="/posts/enable-real-time-jmx-monitoring-in-cognos/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Enable real time JMX monitoring in Cognos.md</span></a></li>
                                
                                <li ><a href="/posts/move-data-or-log-files-for-tempdb-in-sql-server/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Move data or log files for TempDB in SQL Server.md</span></a></li>
                                
                                <li ><a href="/posts/resources-for-remotefx-in-windows-server-2012/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Resources for RemoteFX in Windows Server 2012.md</span></a></li>
                                
                                <li ><a href="/posts/rdp-8.0-for-windows-7-sp1/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">RDP 8.0 for Windows 7 SP1.md</span></a></li>
                                
                                <li ><a href="/posts/improving-remotefx-performance-in-hyper-v/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Improving RemoteFX performance in Hyper-V.md</span></a></li>
                                
                                <li ><a href="/posts/configure-remotefx-in-hyper-v-running-windows-server-2012-with-low-end-gpu/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Configure RemoteFX in Hyper-V running Windows Server 2012 with low end GPU.md</span></a></li>
                                
                                <li ><a href="/posts/sqlps-and-its-limitations/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">SQLPS and its limitations.md</span></a></li>
                                
                                <li ><a href="/posts/script-deployment-of-ssis-packages-from-folder/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Script deployment of SSIS packages from folder.md</span></a></li>
                                
                                <li ><a href="/posts/dynamic-deploy-of-ssrs-reports-using-rs.exe/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Dynamic deploy of SSRS reports using rs.exe.md</span></a></li>
                                
                                <li ><a href="/posts/remove-headers-in-excel-exports-to-fix-column-alignment/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Remove headers in Excel exports to fix column alignment.md</span></a></li>
                                
                                <li ><a href="/posts/using-executionlog2-for-statistics-and-monitoring/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Using ExecutionLog2 for statistics and monitoring.md</span></a></li>
                                
                            </ul>
                        </li>
                        <li><span class="rotate-letter">></span><span class="menu-item">pages</span>
                            <ul>
                                
                                <li ><a href="/about/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">About me.md</span></a></li>
                                
                                <li ><a href="/gists/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Gists.md</span></a></li>
                                
                                <li ><a href="/parameter-validation/"><span class="rotate-letter md-icon">&#10144;</span><span class="menu-item">Parameter Validation.md</span></a></li>
                                
                            </ul>
                        </li>
                    </ul>
                </li>
                <li>><span class="menu-item">data</span></li>
                <li>><span class="menu-item">layouts</span></li>
                <li>><span class="menu-item">resources</span></li>
                <li>><span class="menu-item">static</span></li>
                <li>><span class="menu-item">themes</span></li>
                <li>config.toml</li>
            </ul>
        </li>
    </ul>
  

    
</diV><div class='main'>
     
     
     
    
     
    
     
    
     
    
     
    
    
        
        <div class="main-tabs">
            <div class="main-tabs-scroll">
                <div class="main-tabs-table">
                    <div class ="main-tabs-row">
                        <div class="main-tab">
                            <span class="rotate-letter md-icon">&#10144;</span> <a href="/">Home.md</a> 
                        </div>
                    
                        <div class="main-tab current">
                            <span class="rotate-letter md-icon">&#10144;</span> <i>Compress files to Zip with Powershell.md</i> 
                        </div>
                    
                    
                        <div class="main-tab">
                            <span class="rotate-letter md-icon">&#10144;</span> <a href="/posts/deploy-azure-function-app-without-downtime/">Deploy Azure Function App without downtime.md</a>
                        </div>
                    
                        <div class="main-tab">
                            <span class="rotate-letter md-icon">&#10144;</span> <a href="/posts/moving-from-blogger-to-github-pages-with-hugo/">Moving from Blogger to GitHub Pages using Hugo.md</a>
                        </div>
                    
                        <div class="main-tab">
                            <span class="rotate-letter md-icon">&#10144;</span> <a href="/posts/pester-5-discovery-and-testcases/">Pester 5: Discovery and TestCases.md</a>
                        </div>
                    
                        <div class="main-tab">
                            <span class="rotate-letter md-icon">&#10144;</span> <a href="/posts/create-and-use-azure-table-storage-with-powershell/">Create and use Azure Table storage with PowerShell.md</a>
                        </div>
                    
                        <div class="main-tab">
                            <span class="rotate-letter md-icon">&#10144;</span> <a href="/posts/use-edit-command-to-discover-the-code-behind-built-in-cmdlets/">Use Edit-Command to discover the code behind built-in cmdlets.md</a>
                        </div>
                    
                    </div>
                </div>
            </div>
        </div>
        <div class="main-path">
            <a class="path-link" href="http://blog.roostech.se/">blog.roostech.se</a> > content > posts &gt; Compress files to Zip with Powershell.md
        </div>
        <div class="main-content-toggle">

            
            <input class="source-preview-split" type="checkbox" id="source-preview-split-toggle">
            <label class="source-preview-split-label" for="source-preview-split-toggle"></label>

            <input class="source-toggle" type="checkbox" id="source-toggle">
            <label class="source-toggle-label" for="source-toggle"></label>

            <div class="main-content">
                ---<br />
                <span class="md-frontmatter">title</span>: <span class="md-frontmatter-string">Compress files to Zip with Powershell</span><br />
                <span class="md-frontmatter">date</span>: 2014-12-15 14:14:00 &#43;0200 &#43;0200<br />
                <span class="md-frontmatter">draft</span>: <span class="md-frontmatter">false</span><br />
                <span class="md-frontmatter">author</span>: <span class="md-frontmatter-string">John</span><br />
                ----
                <p>I have seen a lot of people writing PowerShell scripts to compress files or folders by using external file compression programs. Often Winrar, 7-Zip or something similar is used since PowerShell does not have any built in cmdlet to do this (not until version 5 at least).</p>
<p>There is however a pretty simple way of doing this with only PowerShell. This is how.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># First we add the .Net framework class needed for file compression.</span>
<span class="nb">Add-Type</span> <span class="o">-As</span> <span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">Compression</span><span class="p">.</span><span class="n">FileSystem</span>
 
<span class="c"># Then we need a variable of the type System.IO.Compression.CompressionLevel. </span>
<span class="c"># The options for compression level are &#34;Fastest&#34;, &#34;Optimal&#34; and &#34;NoCompression&#34;.</span>
<span class="no">[System.IO.Compression.CompressionLevel]</span><span class="nv">$compression</span> <span class="p">=</span> <span class="s2">&#34;Optimal&#34;</span>
 
<span class="c"># Which file do you want to compress?</span>
<span class="nv">$file</span> <span class="p">=</span> <span class="s1">&#39;C:\temp\file.txt&#39;</span>
 
<span class="c"># Set the path to where you want the zip file to be created.</span>
<span class="nv">$zippath</span> <span class="p">=</span> <span class="s1">&#39;C:\temp\file.zip&#39;</span>
 
<span class="c"># Open the zip file and set the mode. Options for mode are &#34;Create&#34;, &#34;Read&#34; and &#34;Update&#34;.</span>
<span class="nv">$ziparchive</span> <span class="p">=</span> <span class="no">[System.IO.Compression.ZipFile]</span><span class="p">::</span><span class="n">Open</span><span class="p">(</span> <span class="nv">$zippath</span><span class="p">,</span> <span class="s2">&#34;Update&#34;</span> <span class="p">)</span>
 
<span class="c"># The compression function likes relative file paths, so lets do that.</span>
<span class="nv">$relativefilepath</span> <span class="p">=</span> <span class="p">(</span><span class="nb">Resolve-Path</span> <span class="nv">$file</span> <span class="n">-Relative</span><span class="p">).</span><span class="n">TrimStart</span><span class="p">(</span><span class="s2">&#34;.\&#34;</span><span class="p">)</span>
 
<span class="c"># This is where the magic happens. </span>
<span class="c"># Compress the file with the variables you just created as parameters.</span>
<span class="nv">$null</span> <span class="p">=</span> <span class="no">[System.IO.Compression.ZipFileExtensions]</span><span class="p">::</span><span class="n">CreateEntryFromFile</span><span class="p">(</span><span class="nv">$ziparchive</span><span class="p">,</span> <span class="nv">$file</span><span class="p">,</span> <span class="nv">$relativefilepath</span><span class="p">,</span> <span class="nv">$compression</span><span class="p">)</span>
 
<span class="c"># Release the zip file. </span>
<span class="c"># Otherwise the file will still be in read only if you are using Powershell ISE.</span>
<span class="nv">$ziparchive</span><span class="p">.</span><span class="n">Dispose</span><span class="p">()</span>
</code></pre></div><p>Read more about these features at <a href="http://msdn.microsoft.com/en-us/library/System.IO.Compression(v=vs.110).aspx">MSDN</a>.</p>

            </div>

            
            <div class="main-content-preview">
                <h1>Compress files to Zip with Powershell</h1>
                <p>I have seen a lot of people writing PowerShell scripts to compress files or folders by using external file compression programs. Often Winrar, 7-Zip or something similar is used since PowerShell does not have any built in cmdlet to do this (not until version 5 at least).</p>
<p>There is however a pretty simple way of doing this with only PowerShell. This is how.</p>
<div class="highlight"><pre class="chroma"><code class="language-powershell" data-lang="powershell"><span class="c"># First we add the .Net framework class needed for file compression.</span>
<span class="nb">Add-Type</span> <span class="o">-As</span> <span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">Compression</span><span class="p">.</span><span class="n">FileSystem</span>
 
<span class="c"># Then we need a variable of the type System.IO.Compression.CompressionLevel. </span>
<span class="c"># The options for compression level are &#34;Fastest&#34;, &#34;Optimal&#34; and &#34;NoCompression&#34;.</span>
<span class="no">[System.IO.Compression.CompressionLevel]</span><span class="nv">$compression</span> <span class="p">=</span> <span class="s2">&#34;Optimal&#34;</span>
 
<span class="c"># Which file do you want to compress?</span>
<span class="nv">$file</span> <span class="p">=</span> <span class="s1">&#39;C:\temp\file.txt&#39;</span>
 
<span class="c"># Set the path to where you want the zip file to be created.</span>
<span class="nv">$zippath</span> <span class="p">=</span> <span class="s1">&#39;C:\temp\file.zip&#39;</span>
 
<span class="c"># Open the zip file and set the mode. Options for mode are &#34;Create&#34;, &#34;Read&#34; and &#34;Update&#34;.</span>
<span class="nv">$ziparchive</span> <span class="p">=</span> <span class="no">[System.IO.Compression.ZipFile]</span><span class="p">::</span><span class="n">Open</span><span class="p">(</span> <span class="nv">$zippath</span><span class="p">,</span> <span class="s2">&#34;Update&#34;</span> <span class="p">)</span>
 
<span class="c"># The compression function likes relative file paths, so lets do that.</span>
<span class="nv">$relativefilepath</span> <span class="p">=</span> <span class="p">(</span><span class="nb">Resolve-Path</span> <span class="nv">$file</span> <span class="n">-Relative</span><span class="p">).</span><span class="n">TrimStart</span><span class="p">(</span><span class="s2">&#34;.\&#34;</span><span class="p">)</span>
 
<span class="c"># This is where the magic happens. </span>
<span class="c"># Compress the file with the variables you just created as parameters.</span>
<span class="nv">$null</span> <span class="p">=</span> <span class="no">[System.IO.Compression.ZipFileExtensions]</span><span class="p">::</span><span class="n">CreateEntryFromFile</span><span class="p">(</span><span class="nv">$ziparchive</span><span class="p">,</span> <span class="nv">$file</span><span class="p">,</span> <span class="nv">$relativefilepath</span><span class="p">,</span> <span class="nv">$compression</span><span class="p">)</span>
 
<span class="c"># Release the zip file. </span>
<span class="c"># Otherwise the file will still be in read only if you are using Powershell ISE.</span>
<span class="nv">$ziparchive</span><span class="p">.</span><span class="n">Dispose</span><span class="p">()</span>
</code></pre></div><p>Read more about these features at <a href="http://msdn.microsoft.com/en-us/library/System.IO.Compression(v=vs.110).aspx">MSDN</a>.</p>

            </div>

       </div>
    


            </div>
        </div>
    </body>
</html>
